import{x as P,T as Q,Q as l,r as c,w as X,a as r,b as d,d as n,u as t,Z,e as w,f as i,m as j,g as b,F as h,h as E,t as k,v as q,O as H,n as R,z as U,j as D,k as J}from"./app-D6ZAVPTE.js";import{_ as W}from"./AuthenticatedLayout-D3iRYDva.js";import{b as ee,s as I,t as oe,e as se,c as te}from"./etnia-CLDXKfPy.js";import{_ as v}from"./InputError-DTWEfcoR.js";import{_ as p}from"./InputLabel-DTg0HcFB.js";import{_ as ie}from"./PrimaryButton-DuV0HlwJ.js";import{_ as ae}from"./Modal-CI-T2jpO.js";import{_ as x}from"./TextInput-BJGWsFij.js";import{s as ne}from"./index-PRWAo1hB.js";import{s as le}from"./index-DyGuGL-a.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-Dp7rsxvc.js";import"./index-ARwC81Nd.js";import"./index-iryFZE1P.js";import"./index-Be1fzYNM.js";import"./index-C0sc7JcW.js";import"./index-Db8lodK7.js";import"./index-BDKuXpXP.js";import"./index-BJQhEiHc.js";const re={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},de={class:"mt-4 justify-center"},ue={class:"m-auto py-4 px-4"},ce={key:0,class:"sm:grid sm:grid-cols-2 gap-6 h-full"},me={class:"mb-2"},pe=["value"],ve={class:"mb-2"},fe={class:"col-span-2 flex justify-end"},be=["disabled"],ge={key:1,class:"sm:grid sm:grid-cols-2 gap-6"},_e={class:"mb-2"},xe={class:"mb-2"},ye={key:0,class:"text-red-500"},we={class:"mb-2"},he={class:"mt-2 block sm:flex"},ke={class:""},Ve={class:"sm:ms-6"},Se={key:0,class:"sm:ms-6"},je={key:1,class:"sm:ms-6"},Ee={class:"mb-2"},qe=["value"],Ue={class:"mb-2"},Ce=["value"],Ne={class:"mb-2"},$e={class:"mb-2"},Me={class:"col-span-2 flex justify-between gap-2"},Re={class:"flex pt-4 justify-end"},De={class:"flex pt-4 justify-end h-full"},Ie={class:"flex justify-center my-12"},to={__name:"Registro",setup(Fe){const C=P("$swal"),F=[{url:"",text:"Registro votantes"}],e=Q({nombre:"",identificacion:"",tipo_documento:"",nacimiento:"",comuna:l().props.user.jurado.comuna,id_jurado:l().props.user.jurado.id,id_evento:l().props.user.jurado.evento.id,genero:"",etnia:"",condicion:"",direccion:"",barrio:""}),g=c(!1),z=c([{label:"Validación previa"},{label:"Información"}]),L=c([{label:"paso 1"},{label:"paso 2"}]),m=c(0),f=c(""),_=c(""),u=c(!1),y=c(!1);c(!1),c("");const V=c([]);V.value=ee.find(a=>a.id===parseInt(l().props.user.jurado.comuna)).barrios,console.log(V.value),X(y,a=>{a&&(e.genero="")});const B=a=>{m.value=a,u.value=!0},O=()=>{if(!e.nacimiento)return _.value="Debes ingresar la fecha de nacimiento.",!1;const a=new Date,o=e.nacimiento,[s,Y,A]=o.split("-").map(Number);let M=a.getFullYear()-s;const S=a.getMonth()-(Y-1);return console.log(a.getMonth()),console.log(S),console.log(a.getDate()),(S<0||S===0&&a.getDate()<A)&&M--,M<14?(_.value="No cumple con el requisito de edad mínima (14 años), por lo tanto, no puede ejercer el derecho al voto.",!1):(_.value="",!0)},G=async()=>{if(u.value=!1,g.value=!0,e.identificacion&&e.tipo_documento){f.value="",console.log(l().props);try{const a=await T(e.identificacion);if(console.log("Identificación data:",a),g.value=!1,a.existe){if(f.value="La identificación ya está registrada.",a.votante&&a.votante.votos.length>0)f.value+=" Y el votante ya ha emitido su voto en las elecciones.";else{window.location.href=route("votos.index",{id_votante:a.votante.id,evento:l().props.user.jurado.evento.id,tipo_evento:l().props.user.jurado.evento.tipos,tipo_user:a.votante.hash_votantes.length!=0?a.votante.hash_votantes[0].tipo:"",subtipo_user:a.votante.hash_votantes.length!=0?a.votante.hash_votantes[0].subtipo:""});return}u.value=!1}else f.value="",u.value=!0}catch{f.value="Error al validar la identificación. Intenta de nuevo.",u.value=!1}}u.value?m.value=1:(g.value=!1,(!e.identificacion||f.value!="")&&(e.errors.identificacion=f.value||"Este campo es requerido."),e.tipo_documento||(e.errors.tipo_documento="Este campo es requerido."))},T=async a=>{const o=await J.post("/validar-identificacion-presencial",{identificacion:a,registro_presencial:!0});return console.log(o.data),o.data},N=a=>{switch(u.value=!1,a){case 1:G();break;case 2:$();break}u.value&&(m.value=a)},$=()=>{if(u.value=!1,e.nombre&&e.nacimiento&&e.genero&&e.etnia&&e.condicion&&e.barrio&&e.direccion){if(u.value=!0,!O())return;K()}u.value||(e.nombre||(e.errors.nombre="Este campo es requerido."),e.nacimiento||(e.errors.nacimiento="Este campo es requerido."),e.genero||(e.errors.genero="Este campo es requerido."),e.etnia||(e.errors.etnia="Este campo es requerido."),e.condicion||(e.errors.condicion="Este campo es requerido."),e.barrio||(e.errors.barrio="Este campo es requerido."),e.direccion||(e.errors.direccion="Este campo es requerido."))},K=()=>{e.post(route("votantesPresencial.store"),{onSuccess:()=>{C({title:"Registro realizado",text:"Registro de votante realizado exitosamente.",icon:"success"}).then(a=>{console.log(a),window.location.href=route("votos.index",{id_votante:l().props.flash.success.id_votante,evento:l().props.user.jurado.evento.id,tipo_evento:l().props.user.jurado.evento.tipos,tipo_user:l().props.flash.success.hash_votante.tipo,subtipo_user:l().props.flash.success.hash_votante.subtipo})})},onError:a=>{C({title:"Error",text:"Ocurrió un error al registrar el votante.",icon:"error"}).then(o=>{m.value=0}),console.error(a)}})};return(a,o)=>(d(),r(h,null,[n(t(Z),{title:"Registro votantes"}),n(W,{breadCrumbLinks:F},{header:w(()=>o[17]||(o[17]=[D(" Registro de votante ")])),default:w(()=>[i("div",re,[o[25]||(o[25]=i("div",{class:"p-6 border-b border-gray-200"},[i("h1",null,"Registro votante")],-1)),i("div",de,[n(t(I),{class:"hidden sm:block",model:z.value,activeStep:m.value,"onUpdate:activeStep":o[0]||(o[0]=s=>m.value=s)},null,8,["model","activeStep"]),n(t(I),{class:"sm:hidden block",model:L.value,activeStep:m.value,"onUpdate:activeStep":o[1]||(o[1]=s=>m.value=s)},null,8,["model","activeStep"])]),i("form",ue,[m.value==0?(d(),r("div",ce,[i("div",me,[n(p,{for:"tipo_documento",value:"Tipo de Documento"}),b(i("select",{id:"tipo_documento","onUpdate:modelValue":o[2]||(o[2]=s=>t(e).tipo_documento=s),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[18]||(o[18]=i("option",{value:"",disabled:""},"Seleccione tipo de documento",-1)),(d(!0),r(h,null,E(t(oe),s=>(d(),r("option",{key:s.id,value:s.nombre},k(s.nombre),9,pe))),128))],512),[[q,t(e).tipo_documento]]),n(v,{class:"mt-2",message:t(e).errors.tipo_documento},null,8,["message"])]),i("div",ve,[n(p,{for:"identificacion",value:"Identificación"}),n(x,{id:"identificacion",type:"text",class:"mt-1 block w-full",modelValue:t(e).identificacion,"onUpdate:modelValue":o[3]||(o[3]=s=>t(e).identificacion=s),onKeydown:o[4]||(o[4]=H(s=>N(1),["enter"])),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:t(e).errors.identificacion},null,8,["message"])]),i("div",fe,[i("button",{type:"button",class:R(["bg-secondary hover:bg-primary text-xs sm:text-sm text-white p-2 rounded-md shadow-xl",{"opacity-25":g.value}]),onClick:o[5]||(o[5]=s=>N(1)),disabled:g.value}," Siguiente ",10,be)])])):j("",!0),m.value==1?(d(),r("div",ge,[i("div",_e,[n(p,{for:"nombre",value:"Nombre Completo"}),n(x,{id:"nombre",type:"text",class:"mt-1 block w-full",modelValue:t(e).nombre,"onUpdate:modelValue":o[6]||(o[6]=s=>t(e).nombre=s),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:t(e).errors.nombre},null,8,["message"])]),i("div",xe,[n(p,{for:"nacimiento",value:"Fecha de Nacimiento"}),n(x,{id:"nacimiento",type:"date",class:"mt-1 block w-full",modelValue:t(e).nacimiento,"onUpdate:modelValue":o[7]||(o[7]=s=>t(e).nacimiento=s),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:t(e).errors.nacimiento},null,8,["message"]),_.value?(d(),r("p",ye,k(_.value),1)):j("",!0)]),i("div",we,[n(p,{for:"genero",value:"Género"}),i("div",he,[i("div",ke,[b(i("input",{type:"radio",id:"masculino",value:"Masculino","onUpdate:modelValue":o[8]||(o[8]=s=>t(e).genero=s)},null,512),[[U,t(e).genero]]),o[19]||(o[19]=i("label",{class:"ps-2 text-sm sm:text-base",for:"masculino"},"Masculino",-1))]),i("div",Ve,[b(i("input",{type:"radio",id:"two",value:"Femenino","onUpdate:modelValue":o[9]||(o[9]=s=>t(e).genero=s)},null,512),[[U,t(e).genero]]),o[20]||(o[20]=i("label",{class:"ps-2 text-sm sm:text-base",for:"two"},"Femenino",-1))]),y.value?(d(),r("div",Se,[n(p,{class:"sm:text-sm text-xs",for:"genero",value:"¿Cual?"}),n(x,{id:"genero",type:"text",class:"mt-1 block w-full p-0 sm:p-1",modelValue:t(e).genero,"onUpdate:modelValue":o[10]||(o[10]=s=>t(e).genero=s),autocomplete:"genero"},null,8,["modelValue"]),n(v,{class:"mt-1",message:t(e).errors.genero},null,8,["message"])])):(d(),r("div",je,[b(i("input",{type:"radio",id:"tres",value:"true","onUpdate:modelValue":o[11]||(o[11]=s=>y.value=s)},null,512),[[U,y.value]]),o[21]||(o[21]=i("label",{class:"ps-2 text-sm sm:text-base",for:"tres"},"Otro",-1))]))])]),i("div",Ee,[n(p,{for:"etnia",value:"Grupo poblacional"}),b(i("select",{id:"etnia","onUpdate:modelValue":o[12]||(o[12]=s=>t(e).etnia=s),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[22]||(o[22]=i("option",{value:"",disabled:""}," Seleccione grupo poblacional perteneciente ",-1)),(d(!0),r(h,null,E(t(se),s=>(d(),r("option",{key:s.id,value:s.nombre},k(s.nombre),9,qe))),128))],512),[[q,t(e).etnia]]),n(v,{class:"mt-2",message:t(e).errors.etnia},null,8,["message"])]),i("div",Ue,[n(p,{for:"condicion",value:"Condición poblacional"}),b(i("select",{id:"condicion","onUpdate:modelValue":o[13]||(o[13]=s=>t(e).condicion=s),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[23]||(o[23]=i("option",{value:"",disabled:""}," Seleccione condición poblacional ",-1)),(d(!0),r(h,null,E(t(te),s=>(d(),r("option",{key:s.id,value:s.nombre},k(s.nombre),9,Ce))),128))],512),[[q,t(e).condicion]]),n(v,{class:"mt-2",message:t(e).errors.condicion},null,8,["message"])]),i("div",Ne,[n(p,{for:"barrio",value:"Barrio/Vereda"}),n(t(ne),{id:"barrio",modelValue:t(e).barrio,"onUpdate:modelValue":o[14]||(o[14]=s=>t(e).barrio=s),options:V.value,filter:"",placeholder:"Seleccione barrio/vereda de dirección",checkmark:"",highlightOnSelect:!1,class:"w-full"},null,8,["modelValue","options"]),n(v,{class:"mt-2",message:t(e).errors.barrio},null,8,["message"])]),i("div",$e,[n(p,{for:"direccion",value:"Dirección"}),n(x,{id:"direccion",type:"text",class:"mt-1 block w-full",modelValue:t(e).direccion,"onUpdate:modelValue":o[15]||(o[15]=s=>t(e).direccion=s),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:t(e).errors.direccion},null,8,["message"])]),i("div",Me,[i("div",Re,[i("button",{type:"button",onClick:o[16]||(o[16]=s=>B(0)),class:"bg-secondary hover:bg-primary text-xs sm:text-sm text-white px-4 rounded-md shadow-xl"}," Atrás ")]),i("div",De,[n(ie,{type:"button",class:R(["h-full",{"opacity-25":t(e).processing}]),onClick:$,disabled:t(e).processing},{default:w(()=>o[24]||(o[24]=[D(" Siguiente ")])),_:1},8,["class","disabled"])])])])):j("",!0)])])]),_:1}),n(ae,{show:a.loadingModal,closeable:!1},{default:w(()=>[o[26]||(o[26]=i("h2",{class:"py-4 text-2xl font-semibold text-gray-800 flex tex-center justify-center bg-azul text-white"}," Cargando datos... ",-1)),i("div",Ie,[n(t(le),{"aria-label":"Loading"})])]),_:1},8,["show"])],64))}};export{to as default};
