import{x as P,T as z,r as C,q as H,w as F,c as g,o as v,b as t,u as s,Z as A,d as j,e as l,t as y,B as D,p as N,l as W,n as T,j as k,F as O,k as Z}from"./app-DSxmcYn4.js";import{_ as G}from"./AuthenticatedLayout-BYBGmIrD.js";import{_ as r}from"./InputError-BSaFwFpt.js";import{_ as i}from"./InputLabel-DEzsIQ7R.js";import{_ as J}from"./PrimaryButton-GM0abrwE.js";import{_ as n}from"./TextInput-kDU0K6wk.js";import{s as K}from"./index-BvT82NQz.js";import{r as Q}from"./PhotoIcon-DABFbR7l.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BreadCrumb-B5gnLEit.js";import"./SecondaryButtonReturn-CzCDZMeG.js";import"./XCircleIcon-DHK-wLg7.js";import"./index-B0nEjFIt.js";import"./index-eWp6Zrbm.js";const X={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Y={class:"p-6 border-b border-gray-200"},ee={class:"sm:text-xl text-lg font-bold"},oe={class:"mt-2"},se={class:"bg-white p-4 rounded-lg shadow h-auto"},te={class:"flex justify-center items-center mt-4"},ae={class:"border-2 border-gray-300 rounded-md h-full"},le={class:"flex justify-center"},re=["src","alt"],ie={key:0,class:"flex justify-center mt-2"},ne={class:"bg-white p-4 rounded-lg shadow h-full"},de={class:"mt-4 flex flex-wrap gap-4"},ce={class:"mb-2 w-full md:pe-8"},ue={class:"mb-2 sm:w-[calc(50%-.8rem)]"},me={class:"mb-2 sm:w-[calc(50%-0.8rem)]"},_e={class:"mb-2"},ve={class:"mb-2"},fe={class:"mb-2"},ge={class:"mb-2"},be={class:"mb-2 w-1/4"},pe={class:"mb-2 w-full"},he={key:0},we={class:"mb-2 w-1/4"},Ve={class:"mb-2 w-1/4"},ye={class:"mb-2 w-1/4"},xe={class:"mb-2 w-1/4"},Ie={class:""},je={class:"flex justify-center items-center w-full col-span-2 mt-4"},Me={__name:"SubirActa",props:{proyectos:Object,evento:Object,comuna:Number,puesto_votacion:Number,id_jurado:Number,eventos_hijos_vigentes:Object,actas_enviadas:Object,faltan_actas:Number},setup(p){const h=P("$swal"),f=p;console.log(f);const e=z({id_evento:f.eventos_hijos_vigentes[0].id,id_jurado:f.id_jurado,comuna:f.comuna,puesto_votacion:f.puesto_votacion,nombre_testigo:"",Identification_testigo:"",contacto_testigo:"",fecha_inicio:"",fecha_fin:"",hora_inicio:"",hora_cierre:"",votos_nulos:0,votos_blancos:0,votos_no_marcados:0,total_ciudadanos:0,total_votantes:0,observaciones:"",evidencia:null,votos_proyectos:{}}),m=C(null),w=C(!1),U=H(()=>{const o=e.observaciones.trim().length;return o>=250?w.value=!0:w.value=!1,o});F(U,()=>{e.observaciones=e.observaciones.trim()}),F([()=>e.votos_blancos,()=>e.votos_nulos,()=>e.votos_no_marcados,()=>e.votos_proyectos],()=>{const d=parseInt(e.votos_blancos)+parseInt(e.votos_nulos)+parseInt(e.votos_no_marcados),o=Object.values(e.votos_proyectos).reduce((a,_)=>parseInt(a)+parseInt(_||0),0);e.total_votantes=d+o},{deep:!0});const S=d=>(console.log(d),f.proyectos[d]||[]),B=d=>{const o=d.target.files[0];if(!o){m.value=null;return}const a=new FileReader;a.onload=_=>{const b=new Image;b.onload=()=>{const V=document.createElement("canvas"),M=V.getContext("2d"),x=1024,I=1024;let c=b.width,u=b.height;(c>x||u>I)&&(c>u?(u=Math.round(u*x/c),c=x):(c=Math.round(c*I/u),u=I)),V.width=c,V.height=u,M.drawImage(b,0,0,c,u),V.toBlob(q=>{if(q.size>2e6){Swal.fire({icon:"error",title:"Error",text:"Incluso comprimida, la imagen supera los 2MB."});return}const E=new File([q],o.name,{type:"image/jpeg",lastModified:Date.now()});m.value=URL.createObjectURL(E),e.evidencia=E},"image/jpeg",.8)},b.src=_.target.result},a.readAsDataURL(o)},L=()=>{e.evidencia=null,m.value=null},R=()=>{const d=parseInt(e.votos_blancos)+parseInt(e.votos_nulos)+parseInt(e.votos_no_marcados),o=Object.values(e.votos_proyectos).reduce((a,_)=>parseInt(a)+parseInt(_||0),0);if(console.log("Total votos:",d),console.log("Total proyectos:",o),console.log("Total ciudadanos:",e.total_ciudadanos),console.log("Total votantes:",e.total_votantes),parseInt(e.total_ciudadanos)!=parseInt(e.total_votantes)){h.fire({icon:"error",title:"Error",text:"El total de ciudadanos registrados debe ser igual al total de ciudadanos votantes"});return}else if(parseInt(e.total_votantes)!=d+parseInt(o)){h.fire({icon:"error",title:"Error",text:"El total de votantes debe ser igual a la suma de votos nulos, blancos, no marcados y votos por proyecto."});return}console.log(e),e.post(route("actaPresencial.store"),{onSuccess:()=>{h.fire({icon:"success",title:"Éxito",text:"Acta de escrutinio cargada correctamente."}),e.reset(),m.value=null},onError:a=>{console.error(a),h.fire({icon:"error",title:"Error",text:"Hubo un error al enviar el formulario. Por favor, verifica los datos e intenta nuevamente."})}})},$=[{url:"",text:"Carga acta de escrutinio"}];return(d,o)=>(v(),g(O,null,[t(s(A),{title:"Carga de acta"}),t(G,{breadCrumbLinks:$},{header:j(()=>o[14]||(o[14]=[k(" Carga acta de escrutinio y registros ")])),default:j(()=>[l("div",X,[l("div",Y,[l("h1",ee,"Proceso de votación presencial física - "+y(p.eventos_hijos_vigentes[0].nombre),1),l("p",oe,y(p.faltan_actas)+" actas por enviar ",1)]),l("form",{onSubmit:D(R,["prevent"]),class:"md:grid md:grid-cols-2 gap-4 p-6"},[l("div",se,[o[15]||(o[15]=l("h2",{class:"text-lg font-semibold mb-4"},"Subir acta de escrutinio",-1)),o[16]||(o[16]=l("p",null,"Sube el acta de escrutinio en formato imagen.",-1)),l("div",te,[l("div",ae,[t(n,{id:"evidencia",type:"file",class:"!border-0",accept:"image/*",required:"",onInput:o[0]||(o[0]=a=>B(a)),maxFileSize:2e6}),t(r,{class:"mt-2",message:s(e).errors.evidencia},null,8,["message"]),l("div",le,[m.value?(v(),g("img",{key:0,src:m.value,alt:s(e).evidencia,class:"w-4/6 h-full object-contain"},null,8,re)):(v(),W(s(Q),{key:1,class:"w-2/6 text-gray-300 flex justify-center items-center"}))]),m.value?(v(),g("div",ie,[l("button",{onClick:o[1]||(o[1]=a=>L()),type:"button",class:"bg-red-500 text-white px-4 py-2 rounded"}," Eliminar Imagen ")])):N("",!0)])])]),l("div",ne,[o[18]||(o[18]=l("h2",{class:"text-lg font-semibold mb-4"},"Registro de información",-1)),l("div",de,[l("div",ce,[t(i,{for:"nombre_testigo",value:"Nombre del testigo"}),t(n,{id:"nombre_testigo",modelValue:s(e).nombre_testigo,"onUpdate:modelValue":o[2]||(o[2]=a=>s(e).nombre_testigo=a),class:"mt-1 block w-full",type:"text",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.nombre_testigo,class:"mt-2"},null,8,["message"])]),l("div",ue,[t(i,{for:"Identification_testigo",value:"Identificación del testigo"}),t(n,{id:"Identification_testigo",modelValue:s(e).Identification_testigo,"onUpdate:modelValue":o[3]||(o[3]=a=>s(e).Identification_testigo=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.Identification_testigo,class:"mt-2"},null,8,["message"])]),l("div",me,[t(i,{for:"contacto_testigo",value:"Contacto del testigo"}),t(n,{id:"contacto_testigo",modelValue:s(e).contacto_testigo,"onUpdate:modelValue":o[4]||(o[4]=a=>s(e).contacto_testigo=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.contacto_testigo,class:"mt-2"},null,8,["message"])]),l("div",_e,[t(i,{for:"fecha_inicio",value:"Fecha de inicio"}),t(n,{id:"fecha_inicio",modelValue:s(e).fecha_inicio,"onUpdate:modelValue":o[5]||(o[5]=a=>s(e).fecha_inicio=a),class:"mt-1 block w-full",type:"date",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.fecha_inicio,class:"mt-2"},null,8,["message"])]),l("div",ve,[t(i,{for:"fecha_fin",value:"Fecha de fin"}),t(n,{id:"fecha_fin",modelValue:s(e).fecha_fin,"onUpdate:modelValue":o[6]||(o[6]=a=>s(e).fecha_fin=a),class:"mt-1 block w-full",type:"date",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.fecha_fin,class:"mt-2"},null,8,["message"])]),l("div",fe,[t(i,{for:"hora_inicio",value:"Hora de inicio"}),t(n,{id:"hora_inicio",modelValue:s(e).hora_inicio,"onUpdate:modelValue":o[7]||(o[7]=a=>s(e).hora_inicio=a),class:"mt-1 block w-full",type:"time",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.hora_inicio,class:"mt-2"},null,8,["message"])]),l("div",ge,[t(i,{for:"hora_cierre",value:"Hora de cierre"}),t(n,{id:"hora_cierre",modelValue:s(e).hora_cierre,"onUpdate:modelValue":o[8]||(o[8]=a=>s(e).hora_cierre=a),class:"mt-1 block w-full",type:"time",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.hora_cierre,class:"mt-2"},null,8,["message"])]),l("div",be,[t(i,{for:"total_ciudadanos",value:"Total ciudadanos registrados"}),t(n,{id:"total_ciudadanos",modelValue:s(e).total_ciudadanos,"onUpdate:modelValue":o[9]||(o[9]=a=>s(e).total_ciudadanos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.total_ciudadanos,class:"mt-2"},null,8,["message"])]),l("div",pe,[t(i,{for:"observaciones",value:"Observaciones (max 250 caracteres)"}),t(s(K),{modelValue:s(e).observaciones,"onUpdate:modelValue":o[10]||(o[10]=a=>s(e).observaciones=a),variant:"filled",autoResize:"",rows:"5",class:"mt-1 block w-full",required:"",autocomplete:"observaciones"},null,8,["modelValue"]),l("p",{class:T(["text-gray-500 text-sm mt-2",{"text-red-500":w.value}])},[k(y(U.value)+" caracteres ",1),w.value?(v(),g("span",he,"Limite de caracteres superado")):N("",!0)],2),t(r,{message:s(e).errors.observaciones,class:"mt-2"},null,8,["message"])]),o[17]||(o[17]=l("div",{class:"w-full"},[l("h2",null,"Registro de votos")],-1)),l("div",we,[t(i,{for:"votos_nulos",value:"Votos nulos"}),t(n,{id:"votos_nulos",modelValue:s(e).votos_nulos,"onUpdate:modelValue":o[11]||(o[11]=a=>s(e).votos_nulos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_nulos,class:"mt-2"},null,8,["message"])]),l("div",Ve,[t(i,{for:"votos_blancos",value:"Votos blancos"}),t(n,{id:"votos_blancos",modelValue:s(e).votos_blancos,"onUpdate:modelValue":o[12]||(o[12]=a=>s(e).votos_blancos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_blancos,class:"mt-2"},null,8,["message"])]),l("div",ye,[t(i,{for:"votos_no_marcados",value:"Votos no marcados"}),t(n,{id:"votos_no_marcados",modelValue:s(e).votos_no_marcados,"onUpdate:modelValue":o[13]||(o[13]=a=>s(e).votos_no_marcados=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_no_marcados,class:"mt-2"},null,8,["message"])]),(v(!0),g(O,null,Z(S(p.eventos_hijos_vigentes[0].id),a=>(v(),g("div",{key:a.id,class:"mb-2 w-full"},[t(i,{for:"votos_proyecto_"+a.id,value:"Votos proyecto --"+a.numero_tarjeton+" "+a.nombre},null,8,["for","value"]),t(n,{id:"votos_proyecto_"+a.id,modelValue:s(e).votos_proyectos[a.id],"onUpdate:modelValue":_=>s(e).votos_proyectos[a.id]=_,class:"mt-1 block w-full",type:"number",required:""},null,8,["id","modelValue","onUpdate:modelValue"]),t(r,{message:s(e).errors["votos_proyectos."+a.id],class:"mt-2"},null,8,["message"])]))),128)),l("div",xe,[t(i,{for:"total_votos",value:"Total votantes"}),l("b",Ie,y(s(e).total_votantes),1)])])]),l("div",je,[t(J,{class:T(["w-auto",{"opacity-25":s(e).processing}]),disabled:s(e).processing},{default:j(()=>o[19]||(o[19]=[k(" Enviar ")])),_:1},8,["class","disabled"])])],32)])]),_:1})],64))}};export{Me as default};
