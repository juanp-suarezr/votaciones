import{k as P,r as V,T as O,i as G,b as c,e as w,d as l,f as s,u as a,Z as H,j as b,y,g as A,a as f,F as $,h as U,t as z,v as E,n as _,l as M}from"./app-DVHXI1YQ.js";import{_ as D}from"./PrimaryButton-CK3eLPBd.js";import{s as X}from"./PageLayout.vue_vue_type_style_index_0_scoped_05cb4074_lang-BhMRGhWz.js";import{_ as n}from"./InputError--q2hIyx1.js";import{_ as d}from"./InputLabel-gz7Tr2xg.js";import{_ as g}from"./TextInput-BjBdowE7.js";import{s as F}from"./index-Ca_zK8_1.js";import{c as Y}from"./comunas-DceGOULS.js";import{_ as W}from"./AuthenticatedLayout-CdKfNI3y.js";import{_ as Z}from"./SecondaryLink-Cc_imWjd.js";import"./index-C_NnK7TW.js";import"./index-D_pALRlX.js";import"./index-CXB_cAYk.js";import"./index-X7Tht8F0.js";import"./index-B8qhQ6Hf.js";import"./index-BJNdBf5w.js";import"./index-PQdW6Gs3.js";import"./SecondaryButtonReturn-CTYiz2Jz.js";import"./XCircleIcon-CjP0yeku.js";const K={class:"w-full h-full sm:grid sm:grid-cols-2 mx-auto bg-white shadow-lg rounded-lg px-4 sm:px-6 py-12 z-10 gap-6"},Q={class:"col-span-2 w-full"},ee={class:"mb-2"},oe={class:"mb-2"},se={class:"mb-2"},te={class:"mb-2"},ae={class:"mb-2"},le={class:"mb-2"},re=["value"],ne={class:"mb-2"},ie={class:"mb-2"},de={class:"flex gap-4 mb-2"},ue={key:0},ce={key:0,class:"mt-2"},me=["src"],fe={key:1},pe={key:0,class:"mt-2"},ge=["src"],ve={class:"mt-4 flex flex-col items-end"},be={class:"w-full bg-white border shadow-sm rounded-xl"},xe={class:"w-full h-full flex px-4"},we={class:"mt-6 w-full"},ye=["href"],_e={class:"mt-2"},he=["value"],ke={class:"mt-12 flex flex-col items-end"},Je={__name:"RegistroJurados",props:{eventos:{type:Array,default:()=>[]},puntos_votacion:{type:Array,default:()=>[]}},setup(x){const p=P("$swal"),u=V(null),v=V("imagen"),m=V(null);let h=!1;const i=x,B=[{url:route("delegados.index"),text:"Gestion de jurados"},{url:"",text:"Añadir Jurado"}],o=O({nombre:"",identificacion:"",contacto:"",comuna:"",punto_votacion:"",id_evento:"",tipo:"jurado",firma:null,email:"",password:"",jurados:""}),L=r=>{const e=r.target.files[0];if(o.firma=e,e){const t=new FileReader;t.onload=J=>{u.value=J.target.result},t.readAsDataURL(e)}else u.value=null},C=r=>{h=!0;const e=m.value.getContext("2d"),t=S(r);e.beginPath(),e.moveTo(t.x,t.y)},R=r=>{if(!h)return;const e=m.value.getContext("2d"),t=S(r);e.lineTo(t.x,t.y),e.strokeStyle="#222",e.lineWidth=2,e.stroke()},k=()=>{h=!1},j=()=>{m.value.getContext("2d").clearRect(0,0,m.value.width,m.value.height),u.value=null,o.firma=null},T=()=>{m.value.toBlob(r=>{o.firma=new File([r],"firma.webp",{type:"image/webp"});const e=new FileReader;e.onload=t=>{u.value=t.target.result},e.readAsDataURL(o.firma)},"image/webp")},S=r=>{const e=m.value.getBoundingClientRect();return r.touches&&r.touches.length>0?{x:r.touches[0].clientX-e.left,y:r.touches[0].clientY-e.top}:{x:r.offsetX,y:r.offsetY}},q=()=>{console.log(o),o.comuna=o.comuna.value,o.punto_votacion=o.punto_votacion.id,o.post(route("jurados.store"),{forceFormData:!0,onSuccess:()=>{o.reset(),u.value=null,j(),p.fire({title:"Registro exitoso",text:"El jurado ha sido registrado correctamente.",icon:"success",confirmButtonText:"Aceptar"}).then(r=>{})},onError:r=>{console.error(r),p.fire({title:"Error",text:"Hubo un problema al registrar el jurado. Por favor, revisa los campos e intenta nuevamente.",icon:"error",confirmButtonText:"Aceptar"})}})},I=r=>{const e=r.target.files[0];if(!e){o.errors.jurados="Por favor, selecciona un archivo.";return}if(e.size>2*1024*1024){o.errors.jurados="El archivo no debe ser mayor a 2 MB.";return}o.errors.jurados=null,o.jurados=e,console.log(o.jurados)},N=()=>{o.post(route("cargueJurados"),{forceFormData:!0,onSuccess:()=>{i.numRegistrosInsertados!==void 0&&i.numRegistrosActualizados!==void 0?p({title:"Registros Cargados",text:`Se han importado ${i.numRegistrosInsertados} nuevos registros correctamente y ${i.numRegistrosActualizados} actualizados`,icon:"success"}):i.numRegistrosInsertados!==void 0&&i.numRegistrosActualizados==null?p({title:"Registros Cargados",text:`Se han importado ${i.numRegistrosInsertados} nuevos registros correctamente y 0 actualizados`,icon:"success"}):i.numRegistrosInsertados==null&&i.numRegistrosActualizados!==void 0?p({title:"Registros Cargados",text:`Se han importado 0 nuevos registros correctamente y ${i.numRegistrosActualizados} actualizados`,icon:"success"}):p({title:"Registros Cargados",text:"Se han importado los registros de forma masiva",icon:"success"})},onError:r=>{p({title:"Error",text:"Hubo un problema al procesar la solicitud.",icon:"error"})}})};return(r,e)=>(c(),G(W,{breadCrumbLinks:B},{default:w(()=>[l(a(H),{title:"Registro de jurados"}),s("div",K,[s("div",Q,[e[13]||(e[13]=s("h1",{class:"text-2xl font-bold text-center text-gray-800"}," Registro Jurados ",-1)),l(Z,{class:"text-right",href:r.route("delegados.index")},{default:w(()=>e[12]||(e[12]=[b(" Regresar ")])),_:1},8,["href"])]),s("form",{onSubmit:y(q,["prevent"]),enctype:"multipart/form-data",class:"sm:grid sm:grid-cols-2 gap-4 mt-6"},[s("div",ee,[l(d,{for:"nombre",value:"Nombre(*)"}),l(g,{id:"nombre",type:"text",class:"mt-1 block w-full",modelValue:a(o).nombre,"onUpdate:modelValue":e[0]||(e[0]=t=>a(o).nombre=t),required:"",autofocus:"",autocomplete:"off"},null,8,["modelValue"]),l(n,{class:"mt-2",message:a(o).errors.nombre},null,8,["message"])]),s("div",oe,[l(d,{for:"identificacion",value:"Identificación"}),l(g,{id:"identificacion",type:"number",class:"mt-1 block w-full",modelValue:a(o).identificacion,"onUpdate:modelValue":e[1]||(e[1]=t=>a(o).identificacion=t),required:"",autofocus:"",autocomplete:"off"},null,8,["modelValue"]),l(n,{class:"mt-2",message:a(o).errors.identificacion},null,8,["message"])]),s("div",se,[l(d,{for:"contacto",value:"Numero de contacto"}),l(g,{id:"contacto",type:"number",class:"mt-1 block w-full",modelValue:a(o).contacto,"onUpdate:modelValue":e[2]||(e[2]=t=>a(o).contacto=t),required:"",autofocus:"",autocomplete:"off"},null,8,["modelValue"]),l(n,{class:"mt-2",message:a(o).errors.contacto},null,8,["message"])]),s("div",te,[l(d,{for:"comuna",value:"Comuna/corregimiento correspondiente"}),l(a(F),{id:"comuna",modelValue:a(o).comuna,"onUpdate:modelValue":e[3]||(e[3]=t=>a(o).comuna=t),options:a(Y),filter:"",optionLabel:"label",placeholder:"Seleccione comuna",checkmark:"",highlightOnSelect:!1,class:"w-full"},null,8,["modelValue","options"]),l(n,{class:"mt-2",message:a(o).errors.comuna},null,8,["message"])]),s("div",ae,[l(d,{for:"punto_votacion",value:"Punto de votación"}),l(a(F),{id:"punto_votacion",modelValue:a(o).punto_votacion,"onUpdate:modelValue":e[4]||(e[4]=t=>a(o).punto_votacion=t),options:x.puntos_votacion,filter:"",optionLabel:"detalle",placeholder:"Seleccione un punto de votación",checkmark:"",highlightOnSelect:!1,class:"w-full"},null,8,["modelValue","options"]),l(n,{class:"mt-2",message:a(o).errors.punto_votacion},null,8,["message"])]),s("div",le,[l(d,{for:"id_evento",value:"Asignar Evento"}),A(s("select",{id:"id_evento","onUpdate:modelValue":e[5]||(e[5]=t=>a(o).id_evento=t),class:"block mt-1 w-full rounded-md form-select focus:border-sky-600"},[e[14]||(e[14]=s("option",{value:"",disabled:"",selected:""},"Seleccione un evento",-1)),(c(!0),f($,null,U(x.eventos,t=>(c(),f("option",{key:t.id,value:t.id},z(t.nombre),9,re))),128))],512),[[E,a(o).id_evento]]),l(n,{class:"mt-2",message:a(o).errors.id_evento},null,8,["message"])]),s("div",ne,[l(d,{for:"email",value:"Correo Electrónico"}),l(g,{id:"email",type:"email",class:"mt-1 block",modelValue:a(o).email,"onUpdate:modelValue":e[6]||(e[6]=t=>a(o).email=t),required:""},null,8,["modelValue"]),l(n,{class:"mt-2",message:a(o).errors.email},null,8,["message"])]),e[16]||(e[16]=s("div",{class:"mb-2 col-span-2"},[s("div",{class:"bg-azul rounded-md p-2 w-full h-full"},[s("p",{class:"text-white text-base"}," Asegúrese de que la contraseña sea facil de recordar para usted, ya que la necesitará para acceder a su cuenta en el momento de la votación. ")])],-1)),s("div",ie,[l(d,{for:"password",value:"Contraseña (mínimo: 8 caracteres)"}),l(a(X),{id:"password",modelValue:a(o).password,"onUpdate:modelValue":e[7]||(e[7]=t=>a(o).password=t),required:"",toggleMask:""},null,8,["modelValue"]),l(n,{class:"mt-2",message:a(o).errors.password},null,8,["message"])]),s("div",null,[l(d,{for:"firma",value:"Firma"}),s("div",de,[s("button",{type:"button",class:_(["px-2 py-1 rounded",v.value==="imagen"?"bg-blue-600 text-white":"bg-gray-200"]),onClick:e[8]||(e[8]=t=>v.value="imagen")}," Cargar imagen ",2),s("button",{type:"button",class:_(["px-2 py-1 rounded",v.value==="canvas"?"bg-blue-600 text-white":"bg-gray-200"]),onClick:e[9]||(e[9]=t=>v.value="canvas")}," Dibujar firma ",2)]),v.value==="imagen"?(c(),f("div",ue,[l(g,{id:"firma",type:"file",class:"mt-1 block w-full",accept:"image/*",onChange:L}),l(n,{class:"mt-2",message:a(o).errors.firma},null,8,["message"]),u.value?(c(),f("div",ce,[s("img",{src:u.value,alt:"Vista previa de la firma",class:"h-24 border rounded"},null,8,me)])):M("",!0)])):(c(),f("div",fe,[s("canvas",{ref_key:"canvas",ref:m,height:"150",class:"border border-gray-400 rounded-md bg-white cursor-crosshair sm:w-[300px] w-[250px]",onMousedown:C,onMousemove:R,onMouseup:k,onMouseleave:k,onTouchstart:y(C,["prevent"]),onTouchmove:y(R,["prevent"]),onTouchend:k},null,544),s("div",{class:"flex gap-2 mt-1"},[s("button",{type:"button",onClick:j,class:"text-xl text-blue-600 underline"}," Limpiar "),s("button",{type:"button",onClick:T,class:"text-xl text-green-600 underline"}," Usar firma ")]),l(n,{class:"mt-2",message:a(o).errors.firma},null,8,["message"]),u.value?(c(),f("div",pe,[s("img",{src:u.value,alt:"Vista previa de la firma",class:"h-24 border rounded"},null,8,ge)])):M("",!0)]))]),s("div",ve,[l(D,{class:_({"opacity-25":a(o).processing}),disabled:a(o).processing},{default:w(()=>e[15]||(e[15]=[b(" Registrarse ")])),_:1},8,["class","disabled"])])],32),s("div",be,[e[22]||(e[22]=s("div",{class:"bg-gray-100 border-b rounded-t-xl py-3 px-4 md:py-4 md:px-5 flex"},[s("h3",{class:"text-gray-500 m-auto"},"CARGUE MASIVO")],-1)),s("div",xe,[s("div",we,[e[20]||(e[20]=s("p",{class:""},[s("b",null,"Nota:"),b(" Para subir masivamente la lista de jurados, debe descargar la plantilla, dando clic en el siguiente botón. ")],-1)),s("a",{href:r.route("plantillaJur.excel"),class:"flex inline-flex text-white bg-green-800 hover:bg-blue-800 font-medium rounded-lg text-sm px-4 py-2 mt-4"},e[17]||(e[17]=[s("i",{class:"fa-solid fa-file-arrow-down m-auto me-2"},null,-1),b("Descargar plantilla ")]),8,ye),e[21]||(e[21]=s("p",{class:"mt-4"}," Luego de descargar la plantilla y cargar los datos, subir el mismo archivo excel en el apartado de abajo. ",-1)),s("form",{onSubmit:y(N,["prevent"])},[s("div",_e,[l(d,{for:"id_evento",value:"Asignar Evento"}),A(s("select",{id:"id_evento","onUpdate:modelValue":e[10]||(e[10]=t=>a(o).id_evento=t),class:"block mt-1 w-full rounded-md form-select focus:border-sky-600"},[e[18]||(e[18]=s("option",{value:"",disabled:"",selected:""}," Seleccione un evento ",-1)),(c(!0),f($,null,U(x.eventos,t=>(c(),f("option",{key:t.id,value:t.id},z(t.nombre),9,he))),128))],512),[[E,a(o).id_evento]]),l(n,{class:"mt-2",message:a(o).errors.id_evento},null,8,["message"])]),l(g,{id:"cargueMasivoJurados",type:"file",class:"mt-4 block w-full",onChange:e[11]||(e[11]=t=>I(t))}),l(n,{class:"mt-2",message:a(o).errors.jurados},null,8,["message"]),s("div",null,[s("div",ke,[l(D,{class:_({"opacity-25":a(o).processing}),disabled:a(o).processing},{default:w(()=>e[19]||(e[19]=[b(" Enviar ")])),_:1},8,["class","disabled"])])])],32)])])])])]),_:1}))}};export{Je as default};
