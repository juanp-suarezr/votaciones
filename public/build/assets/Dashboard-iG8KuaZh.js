import{o as n,c as l,E as _,d as i,t as m,m as w,r as g,g as B,T as S,a as M,u as p,w as D,F as V,Z as j,i as T,h as P,v as U,b as y,j as K,n as O}from"./app-h2eVGlAo.js";import{_ as $}from"./AuthenticatedLayout-0Lx5B2OY.js";import{_ as W}from"./PrimaryLink-YT7ttm1w.js";import{d as F}from"./index-sSzdcNuS.js";import{s as H,a as I}from"./chart.esm-Tbg_6TCP.js";import{B as G,s as Z}from"./basecomponent.esm-U5Bu4RZK.js";import"./index.esm-ggPAMPNt.js";import"./ripple.esm-tSX4VvqJ.js";var q={root:function(t){var r=t.props;return["p-knob p-component",{"p-disabled":r.disabled}]},range:"p-knob-range",value:"p-knob-value",label:"p-knob-text"},J=G.extend({name:"knob",classes:q}),Q={name:"BaseKnob",extends:Z,props:{modelValue:{type:Number,default:null},size:{type:Number,default:100},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},step:{type:Number,default:1},min:{type:Number,default:0},max:{type:Number,default:100},valueColor:{type:String,default:"var(--primary-color, Black)"},rangeColor:{type:String,default:"var(--surface-border, LightGray)"},textColor:{type:String,default:"var(--text-color-secondary, Black)"},strokeWidth:{type:Number,default:14},showValue:{type:Boolean,default:!0},valueTemplate:{type:String,default:"{value}"},tabindex:{type:Number,default:0},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:J,provide:function(){return{$parentInstance:this}}},x=3.14159265358979,L={name:"Knob",extends:Q,emits:["update:modelValue","change"],data:function(){return{radius:40,midX:50,midY:50,minRadians:4*x/3,maxRadians:-x/3}},methods:{updateValue:function(t,r){var d=t-this.size/2,u=this.size/2-r,s=Math.atan2(u,d),k=-x/2-x/6;this.updateModel(s,k)},updateModel:function(t,r){var d;if(t>this.maxRadians)d=this.mapRange(t,this.minRadians,this.maxRadians,this.min,this.max);else if(t<r)d=this.mapRange(t+2*x,this.minRadians,this.maxRadians,this.min,this.max);else return;var u=Math.round((d-this.min)/this.step)*this.step+this.min;this.$emit("update:modelValue",u),this.$emit("change",u)},updateModelValue:function(t){t>this.max?this.$emit("update:modelValue",this.max):t<this.min?this.$emit("update:modelValue",this.min):this.$emit("update:modelValue",t)},mapRange:function(t,r,d,u,s){return(t-r)*(s-u)/(d-r)+u},onClick:function(t){!this.disabled&&!this.readonly&&this.updateValue(t.offsetX,t.offsetY)},onMouseDown:function(t){!this.disabled&&!this.readonly&&(window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),t.preventDefault())},onMouseUp:function(t){!this.disabled&&!this.readonly&&(window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),t.preventDefault())},onTouchStart:function(t){!this.disabled&&!this.readonly&&(window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),t.preventDefault())},onTouchEnd:function(t){!this.disabled&&!this.readonly&&(window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),t.preventDefault())},onMouseMove:function(t){!this.disabled&&!this.readonly&&(this.updateValue(t.offsetX,t.offsetY),t.preventDefault())},onTouchMove:function(t){if(!this.disabled&&!this.readonly&&t.touches.length==1){var r=this.$el.getBoundingClientRect(),d=t.targetTouches.item(0),u=d.clientX-r.left,s=d.clientY-r.top;this.updateValue(u,s)}},onKeyDown:function(t){if(!this.disabled&&!this.readonly)switch(t.code){case"ArrowRight":case"ArrowUp":{t.preventDefault(),this.updateModelValue(this.modelValue+this.step);break}case"ArrowLeft":case"ArrowDown":{t.preventDefault(),this.updateModelValue(this.modelValue-this.step);break}case"Home":{t.preventDefault(),this.$emit("update:modelValue",this.min);break}case"End":{t.preventDefault(),this.$emit("update:modelValue",this.max);break}case"PageUp":{t.preventDefault(),this.updateModelValue(this.modelValue+10);break}case"PageDown":{t.preventDefault(),this.updateModelValue(this.modelValue-10);break}}}},computed:{rangePath:function(){return"M ".concat(this.minX," ").concat(this.minY," A ").concat(this.radius," ").concat(this.radius," 0 1 1 ").concat(this.maxX," ").concat(this.maxY)},valuePath:function(){return"M ".concat(this.zeroX," ").concat(this.zeroY," A ").concat(this.radius," ").concat(this.radius," 0 ").concat(this.largeArc," ").concat(this.sweep," ").concat(this.valueX," ").concat(this.valueY)},zeroRadians:function(){return this.min>0&&this.max>0?this.mapRange(this.min,this.min,this.max,this.minRadians,this.maxRadians):this.mapRange(0,this.min,this.max,this.minRadians,this.maxRadians)},valueRadians:function(){return this.mapRange(this.modelValue,this.min,this.max,this.minRadians,this.maxRadians)},minX:function(){return this.midX+Math.cos(this.minRadians)*this.radius},minY:function(){return this.midY-Math.sin(this.minRadians)*this.radius},maxX:function(){return this.midX+Math.cos(this.maxRadians)*this.radius},maxY:function(){return this.midY-Math.sin(this.maxRadians)*this.radius},zeroX:function(){return this.midX+Math.cos(this.zeroRadians)*this.radius},zeroY:function(){return this.midY-Math.sin(this.zeroRadians)*this.radius},valueX:function(){return this.midX+Math.cos(this.valueRadians)*this.radius},valueY:function(){return this.midY-Math.sin(this.valueRadians)*this.radius},largeArc:function(){return Math.abs(this.zeroRadians-this.valueRadians)<x?0:1},sweep:function(){return this.valueRadians>this.zeroRadians?0:1},valueToDisplay:function(){return this.valueTemplate.replace(/{value}/g,this.modelValue)}}},ee=["width","height","tabindex","aria-valuemin","aria-valuemax","aria-valuenow","aria-labelledby","aria-label"],te=["d","stroke-width","stroke"],ae=["d","stroke-width","stroke"],se=["fill"];function oe(e,t,r,d,u,s){return n(),l("div",_({class:e.cx("root")},e.ptm("root")),[(n(),l("svg",_({viewBox:"0 0 100 100",role:"slider",width:e.size,height:e.size,tabindex:e.readonly||e.disabled?-1:e.tabindex,"aria-valuemin":e.min,"aria-valuemax":e.max,"aria-valuenow":e.modelValue,"aria-labelledby":e.ariaLabelledby,"aria-label":e.ariaLabel,onClick:t[0]||(t[0]=function(){return s.onClick&&s.onClick.apply(s,arguments)}),onKeydown:t[1]||(t[1]=function(){return s.onKeyDown&&s.onKeyDown.apply(s,arguments)}),onMousedown:t[2]||(t[2]=function(){return s.onMouseDown&&s.onMouseDown.apply(s,arguments)}),onMouseup:t[3]||(t[3]=function(){return s.onMouseUp&&s.onMouseUp.apply(s,arguments)}),onTouchstartPassive:t[4]||(t[4]=function(){return s.onTouchStart&&s.onTouchStart.apply(s,arguments)}),onTouchend:t[5]||(t[5]=function(){return s.onTouchEnd&&s.onTouchEnd.apply(s,arguments)})},e.ptm("svg")),[i("path",_({d:s.rangePath,"stroke-width":e.strokeWidth,stroke:e.rangeColor,class:e.cx("range")},e.ptm("range")),null,16,te),i("path",_({d:s.valuePath,"stroke-width":e.strokeWidth,stroke:e.valueColor,class:e.cx("value")},e.ptm("value")),null,16,ae),e.showValue?(n(),l("text",_({key:0,x:50,y:57,"text-anchor":"middle",fill:e.textColor,class:e.cx("label")},e.ptm("label")),m(s.valueToDisplay),17,se)):w("",!0)],16,ee))],16)}L.render=oe;const ie={key:0,class:""},ne=i("h2",{class:"text-gray-600 text-xl inline-flex"},"Votaciones pendientes",-1),le={class:"md:grid md:grid-cols-2 gap-4 mt-4 mb-4"},re={class:"border-2 border-gray-400 p-2 border-dashed sm:flex"},de={class:"m-auto text-base pe-2"},ue=i("br",null,null,-1),he={class:"text-sm text-gray-600"},ce=i("br",null,null,-1),me={key:0,class:"text-base text-gray-800 italic"},ve=i("h2",{class:"text-gray-600 text-xl inline-flex"},"Votaciones cerradas",-1),pe={class:"md:grid md:grid-cols-2 gap-4 mt-4"},fe={class:"border-2 border-gray-400 p-2 border-dashed sm:flex"},ge={class:"m-auto text-base pe-2"},be=i("br",null,null,-1),ye={class:"text-sm text-gray-600"},xe=i("br",null,null,-1),we={key:0,class:"text-base text-gray-800 italic"},ke={key:1,class:""},_e={key:0,class:"flex flex-col justify-center"},Me={class:"sm:flex justify-center items-center"},Ve=i("option",{selected:"",value:"",disabled:""},"Elegir evento de votación",-1),Re=["value"],De={class:"sm:grid grid-cols-2 gap-4 mt-4"},Te={class:"w-full flex flex-col justify-center rounded-xl p-2 shadow-xl flex m-auto h-full bg-gray-500 mb-4"},Ce={class:"text-gray-200 text-lg sm:text-xl font-bold text-center flex justify-center"},Xe=i("br",null,null,-1),Ee={class:"w-full flex flex-col justify-center rounded-xl p-2 shadow-xl flex m-auto h-full bg-gray-500"},ze=i("h2",{class:"text-gray-200 text-lg sm:text-xl font-bold text-center flex justify-center"}," Total votos según tipo ",-1),Le={key:1,class:"flex justify-center"},Oe={__name:"Dashboard",props:{eventos:Object,votos:Object,candidatos:Object,eventos_admin:Object,votantes:Object},setup(e){const t=e;console.log(t);const r=g([]),d=g([]);B(()=>{r.value=t.eventos.filter(a=>a.estado!="Cerrado"&&a.votantes!=null),d.value=t.eventos.filter(a=>a.estado=="Cerrado"&&a.votantes!=null),s.value=E(),k.value=z()});const u=F.useToast(),s=g(),k=g(),C=new URLSearchParams(window.location.search).get("error"),f=g(t.eventos_admin.length?t.eventos_admin[0].id:""),h=g(t.eventos_admin.length?t.eventos_admin.find(a=>a.id==f.value):[]),X=g(h.value.tipos!="NA"?h.value.tipos.replace(/\s*\|\s*/g,", ").split(", "):"NA"),Y=()=>{let a=[];return X.value.forEach(c=>{a.push(h.value.votos.filter(o=>o.tipo==c).length)}),a.join(", ").split(",").map(c=>c.trim())},E=()=>({labels:A(h.value.tipos!="NA"?h.value.tipos.replace(/\s*\|\s*/g,", "):"NA"),datasets:[{label:"Votos",data:Y(),backgroundColor:["rgba(59, 130, 246, 1)"]}]}),z=()=>{const a="#fff";return{indexAxis:"y",maintainAspectRatio:!1,aspectRatio:2,plugins:{legend:{labels:{color:a}}},scales:{x:{ticks:{color:a,font:{weight:500}},grid:{display:!1,drawBorder:!0}},y:{ticks:{color:a},grid:{color:"#000",drawBorder:!0}}}}};function A(a){return a.split(",").map(c=>c.trim())}const b=S({votos:h.value.votos!=null?t.eventos_admin.find(a=>a.id==f.value).votos.length:0,votantes:t.votantes.filter(a=>a.id_evento==f.value).length});C&&(console.log(C),u.open({message:"Usted ya ha realizado el voto, No puede volver a votar",type:"error",position:"top-right",duration:8e3,pauseOnHover:!0}));const N=()=>{h.value=t.eventos_admin.length?t.eventos_admin.find(a=>a.id==f.value):[],b.votos=h.value.votos!=null?h.value.votos.length:0,X.value=h.value.tipos!="NA"?h.value.tipos.replace(/\s*\|\s*/g,", ").split(", "):"NA",b.votantes=t.votantes.filter(a=>a.id_evento==f.value).length,s.value=E(),k.value=z()};return(a,c)=>(n(),l(V,null,[M(p(j),{title:"Dashboard"}),M($,null,{default:D(()=>[a.$page.props.user.roles.includes("Usuarios")?(n(),l("div",ie,[ne,i("div",le,[(n(!0),l(V,null,T(r.value,o=>(n(),l("div",{class:"items-center px-4 m-auto w-full",key:o.id},[i("div",re,[i("p",de,[y(m(o.nombre)+" ",1),ue,i("span",he,m(o.fecha_inicio)+" - "+m(o.fecha_fin),1),ce,e.votos.find(v=>v.id_eventos==o.id)?(n(),l("span",me," Usted ha votado por "+m(e.candidatos.find(v=>v.id_votante==e.votos.find(R=>R.id_eventos==o.id).id_candidato).votante.nombre),1)):w("",!0)]),o.estado=="Activo"&&!e.votos.find(v=>v.id_eventos==o.id)?(n(),K(W,{key:0,class:O(["md:text-base m-auto",{"opacity-25":a.isLoading}]),disabled:a.isLoading,href:a.route("votos.index",{tipo_evento:o.id,tipo_user:o.votantes?o.votantes.tipo:""})},{default:D(()=>[y(" Votar ")]),_:2},1032,["class","disabled","href"])):w("",!0)])]))),128))]),ve,i("div",pe,[(n(!0),l(V,null,T(d.value,o=>(n(),l("div",{class:"items-center px-4 m-auto w-full",key:o.id},[i("div",fe,[i("p",ge,[y(m(o.nombre)+" ",1),be,i("span",ye,m(o.fecha_inicio)+" - "+m(o.fecha_fin),1),xe,e.votos.find(v=>v.id_eventos==o.id)?(n(),l("span",we," Usted ha votado por "+m(e.candidatos.find(v=>v.id_votante==e.votos.find(R=>R.id_eventos==o.id).id_candidato).votante.nombre),1)):w("",!0)])])]))),128))])])):w("",!0),a.$page.props.user.roles.includes("Administrador")||a.$page.props.user.roles.includes("Supervisor")||a.$page.props.user.roles.includes("Visor")?(n(),l("div",ke,[e.eventos_admin.length?(n(),l("div",_e,[i("div",Me,[P(i("select",{id:"evento_selected",name:"evento_selected","onUpdate:modelValue":c[0]||(c[0]=o=>f.value=o),onChange:N,class:"block w-full p-2 text-base text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500"},[Ve,(n(!0),l(V,null,T(e.eventos_admin,o=>(n(),l("option",{class:"flex cursor mb-2 sm:mb-auto",key:o.id,value:o.id},m(o.nombre),9,Re))),128))],544),[[U,f.value]])]),i("div",De,[i("div",Te,[i("h2",Ce,[y(" Nivel de votaciones "),Xe,y(" Total Votantes habilitados - "+m(p(b).votantes),1)]),M(p(L),{class:"flex justify-center mt-4",modelValue:p(b).votos,"onUpdate:modelValue":c[1]||(c[1]=o=>p(b).votos=o),size:200,readonly:"",max:p(b).votantes},null,8,["modelValue","max"])]),i("div",Ee,[ze,M(p(H),{type:"bar",data:s.value,options:k.value,class:"h-full m-2"},null,8,["data","options"])])])])):(n(),l("div",Le,[M(p(I),{severity:"info",sticky:a.sticky,class:"text-center w-fit",life:3e3},{default:D(()=>[y("Los eventos de votación activos serán mostrados en esta sección")]),_:1},8,["sticky"])]))])):w("",!0)]),_:1})],64))}};export{Oe as default};
