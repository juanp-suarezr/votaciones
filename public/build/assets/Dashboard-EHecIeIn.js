import{o as n,c as u,E as x,d as i,t as f,m as b,g as j,r as M,T as N,a as w,u as m,w as V,F as R,Z as P,i as E,b as k,j as U,n as A,h as K,v as O}from"./app-N76a7DKK.js";import{_ as $}from"./AuthenticatedLayout-mpq8oLqM.js";import{_ as W}from"./PrimaryLink-OSU58tGH.js";import{d as F}from"./index-lQ-8wrXr.js";import{s as H,a as I}from"./chart.esm-ryxQRm8c.js";import{B as G,s as J}from"./basecomponent.esm-UcDePv2S.js";import"./index.esm-ae86mGB1.js";import"./ripple.esm-NsaROEpa.js";var Z={root:function(e){var r=e.props;return["p-knob p-component",{"p-disabled":r.disabled}]},range:"p-knob-range",value:"p-knob-value",label:"p-knob-text"},q=G.extend({name:"knob",classes:Z}),Q={name:"BaseKnob",extends:J,props:{modelValue:{type:Number,default:null},size:{type:Number,default:100},disabled:{type:Boolean,default:!1},readonly:{type:Boolean,default:!1},step:{type:Number,default:1},min:{type:Number,default:0},max:{type:Number,default:100},valueColor:{type:String,default:"var(--primary-color, Black)"},rangeColor:{type:String,default:"var(--surface-border, LightGray)"},textColor:{type:String,default:"var(--text-color-secondary, Black)"},strokeWidth:{type:Number,default:14},showValue:{type:Boolean,default:!0},valueTemplate:{type:String,default:"{value}"},tabindex:{type:Number,default:0},ariaLabelledby:{type:String,default:null},ariaLabel:{type:String,default:null}},style:q,provide:function(){return{$parentInstance:this}}},g=3.14159265358979,X={name:"Knob",extends:Q,emits:["update:modelValue","change"],data:function(){return{radius:40,midX:50,midY:50,minRadians:4*g/3,maxRadians:-g/3}},methods:{updateValue:function(e,r){var h=e-this.size/2,l=this.size/2-r,a=Math.atan2(l,h),_=-g/2-g/6;this.updateModel(a,_)},updateModel:function(e,r){var h;if(e>this.maxRadians)h=this.mapRange(e,this.minRadians,this.maxRadians,this.min,this.max);else if(e<r)h=this.mapRange(e+2*g,this.minRadians,this.maxRadians,this.min,this.max);else return;var l=Math.round((h-this.min)/this.step)*this.step+this.min;this.$emit("update:modelValue",l),this.$emit("change",l)},updateModelValue:function(e){e>this.max?this.$emit("update:modelValue",this.max):e<this.min?this.$emit("update:modelValue",this.min):this.$emit("update:modelValue",e)},mapRange:function(e,r,h,l,a){return(e-r)*(a-l)/(h-r)+l},onClick:function(e){!this.disabled&&!this.readonly&&this.updateValue(e.offsetX,e.offsetY)},onMouseDown:function(e){!this.disabled&&!this.readonly&&(window.addEventListener("mousemove",this.onMouseMove),window.addEventListener("mouseup",this.onMouseUp),e.preventDefault())},onMouseUp:function(e){!this.disabled&&!this.readonly&&(window.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("mouseup",this.onMouseUp),e.preventDefault())},onTouchStart:function(e){!this.disabled&&!this.readonly&&(window.addEventListener("touchmove",this.onTouchMove),window.addEventListener("touchend",this.onTouchEnd),e.preventDefault())},onTouchEnd:function(e){!this.disabled&&!this.readonly&&(window.removeEventListener("touchmove",this.onTouchMove),window.removeEventListener("touchend",this.onTouchEnd),e.preventDefault())},onMouseMove:function(e){!this.disabled&&!this.readonly&&(this.updateValue(e.offsetX,e.offsetY),e.preventDefault())},onTouchMove:function(e){if(!this.disabled&&!this.readonly&&e.touches.length==1){var r=this.$el.getBoundingClientRect(),h=e.targetTouches.item(0),l=h.clientX-r.left,a=h.clientY-r.top;this.updateValue(l,a)}},onKeyDown:function(e){if(!this.disabled&&!this.readonly)switch(e.code){case"ArrowRight":case"ArrowUp":{e.preventDefault(),this.updateModelValue(this.modelValue+this.step);break}case"ArrowLeft":case"ArrowDown":{e.preventDefault(),this.updateModelValue(this.modelValue-this.step);break}case"Home":{e.preventDefault(),this.$emit("update:modelValue",this.min);break}case"End":{e.preventDefault(),this.$emit("update:modelValue",this.max);break}case"PageUp":{e.preventDefault(),this.updateModelValue(this.modelValue+10);break}case"PageDown":{e.preventDefault(),this.updateModelValue(this.modelValue-10);break}}}},computed:{rangePath:function(){return"M ".concat(this.minX," ").concat(this.minY," A ").concat(this.radius," ").concat(this.radius," 0 1 1 ").concat(this.maxX," ").concat(this.maxY)},valuePath:function(){return"M ".concat(this.zeroX," ").concat(this.zeroY," A ").concat(this.radius," ").concat(this.radius," 0 ").concat(this.largeArc," ").concat(this.sweep," ").concat(this.valueX," ").concat(this.valueY)},zeroRadians:function(){return this.min>0&&this.max>0?this.mapRange(this.min,this.min,this.max,this.minRadians,this.maxRadians):this.mapRange(0,this.min,this.max,this.minRadians,this.maxRadians)},valueRadians:function(){return this.mapRange(this.modelValue,this.min,this.max,this.minRadians,this.maxRadians)},minX:function(){return this.midX+Math.cos(this.minRadians)*this.radius},minY:function(){return this.midY-Math.sin(this.minRadians)*this.radius},maxX:function(){return this.midX+Math.cos(this.maxRadians)*this.radius},maxY:function(){return this.midY-Math.sin(this.maxRadians)*this.radius},zeroX:function(){return this.midX+Math.cos(this.zeroRadians)*this.radius},zeroY:function(){return this.midY-Math.sin(this.zeroRadians)*this.radius},valueX:function(){return this.midX+Math.cos(this.valueRadians)*this.radius},valueY:function(){return this.midY-Math.sin(this.valueRadians)*this.radius},largeArc:function(){return Math.abs(this.zeroRadians-this.valueRadians)<g?0:1},sweep:function(){return this.valueRadians>this.zeroRadians?0:1},valueToDisplay:function(){return this.valueTemplate.replace(/{value}/g,this.modelValue)}}},ee=["width","height","tabindex","aria-valuemin","aria-valuemax","aria-valuenow","aria-labelledby","aria-label"],te=["d","stroke-width","stroke"],ae=["d","stroke-width","stroke"],se=["fill"];function oe(t,e,r,h,l,a){return n(),u("div",x({class:t.cx("root")},t.ptm("root")),[(n(),u("svg",x({viewBox:"0 0 100 100",role:"slider",width:t.size,height:t.size,tabindex:t.readonly||t.disabled?-1:t.tabindex,"aria-valuemin":t.min,"aria-valuemax":t.max,"aria-valuenow":t.modelValue,"aria-labelledby":t.ariaLabelledby,"aria-label":t.ariaLabel,onClick:e[0]||(e[0]=function(){return a.onClick&&a.onClick.apply(a,arguments)}),onKeydown:e[1]||(e[1]=function(){return a.onKeyDown&&a.onKeyDown.apply(a,arguments)}),onMousedown:e[2]||(e[2]=function(){return a.onMouseDown&&a.onMouseDown.apply(a,arguments)}),onMouseup:e[3]||(e[3]=function(){return a.onMouseUp&&a.onMouseUp.apply(a,arguments)}),onTouchstartPassive:e[4]||(e[4]=function(){return a.onTouchStart&&a.onTouchStart.apply(a,arguments)}),onTouchend:e[5]||(e[5]=function(){return a.onTouchEnd&&a.onTouchEnd.apply(a,arguments)})},t.ptm("svg")),[i("path",x({d:a.rangePath,"stroke-width":t.strokeWidth,stroke:t.rangeColor,class:t.cx("range")},t.ptm("range")),null,16,te),i("path",x({d:a.valuePath,"stroke-width":t.strokeWidth,stroke:t.valueColor,class:t.cx("value")},t.ptm("value")),null,16,ae),t.showValue?(n(),u("text",x({key:0,x:50,y:57,"text-anchor":"middle",fill:t.textColor,class:t.cx("label")},t.ptm("label")),f(a.valueToDisplay),17,se)):b("",!0)],16,ee))],16)}X.render=oe;const ie={key:0,class:""},ne=i("h2",{class:"text-gray-600 text-xl inline-flex"},"Votaciones pendientes",-1),re={class:"md:grid md:grid-cols-2 gap-4 mt-4"},le={key:0,class:"border-2 border-gray-400 p-2 border-dashed sm:flex"},de={class:"m-auto text-base pe-2"},ue=i("br",null,null,-1),he={class:"text-sm text-gray-600"},ce=i("br",null,null,-1),me={key:0,class:"text-base text-gray-800 italic"},ve={key:1,class:""},fe={key:0,class:"flex flex-col justify-center"},pe={class:"sm:flex justify-center items-center"},ge=i("option",{selected:"",value:"",disabled:""},"Elegir evento de votación",-1),be=["value"],ye={class:"sm:grid grid-cols-2 gap-4 mt-4"},xe={class:"w-full flex flex-col justify-center rounded-xl p-2 shadow-xl flex m-auto h-full bg-gray-500 mb-4"},we={class:"text-gray-200 text-lg sm:text-xl font-bold text-center flex justify-center"},ke=i("br",null,null,-1),Me={class:"w-full flex flex-col justify-center rounded-xl p-2 shadow-xl flex m-auto h-full bg-gray-500"},Ve=i("h2",{class:"text-gray-200 text-lg sm:text-xl font-bold text-center flex justify-center"}," Total votos según tipo ",-1),Re={key:1,class:"flex justify-center"},Se={__name:"Dashboard",props:{eventos:Object,votos:Object,candidatos:Object,eventos_admin:Object,votantes:Object},setup(t){const e=t;console.log(e),j(()=>{l.value=T(),a.value=C();const s=new EventSource("/sse");s.onmessage=function(d){const o=JSON.parse(d.data);r(d.data),o.event}});function r(s){e.eventos_admin=s.eventos_admin,e.votantes=s.votantes}const h=F.useToast(),l=M(),a=M(),D=new URLSearchParams(window.location.search).get("error"),c=M(e.eventos_admin.length?e.eventos_admin[0].id:""),v=M(e.eventos_admin.length?e.eventos_admin.find(s=>s.id==c.value):[]),z=v.value.length??v.value.tipos.replace(/\s*\|\s*/g,", ").split(", "),L=()=>{let s=[];return z.forEach(d=>{s.push(v.value.votos.filter(o=>o.tipo==d).length)}),s.join(", ").split(",").map(d=>d.trim())},T=()=>({labels:S(v.value.length?v.value.tipos.replace(/\s*\|\s*/g,", "):""),datasets:[{label:"Votos",data:L(),backgroundColor:["rgba(59, 130, 246, 1)"]}]}),C=()=>{const s="#fff";return{indexAxis:"y",maintainAspectRatio:!1,aspectRatio:2,plugins:{legend:{labels:{color:s}}},scales:{x:{ticks:{color:s,font:{weight:500}},grid:{display:!1,drawBorder:!0}},y:{ticks:{color:s},grid:{color:"#000",drawBorder:!0}}}}};function S(s){return s.split(",").map(d=>d.trim())}const p=N({votos:c.value!=""?e.eventos_admin.find(s=>s.id==c.value).votos.length:0,votantes:e.votantes.filter(s=>s.id_eventos==c.value).length});D&&(console.log(D),h.open({message:"Usted ya ha realizado el voto, No puede volver a votar",type:"error",position:"top-right",duration:8e3,pauseOnHover:!0}));const Y=()=>{v.value=e.eventos_admin.length??e.eventos_admin.find(s=>s.id==c.value),p.votos=c.value!=""?v.value.votos.length:0,p.votantes=e.votantes.filter(s=>s.id_eventos==c.value).length,l.value=T(),a.value=C()};return(s,d)=>(n(),u(R,null,[w(m(P),{title:"Dashboard"}),w($,null,{default:V(()=>[s.$page.props.user.roles.includes("Usuarios")?(n(),u("div",ie,[ne,i("div",re,[(n(!0),u(R,null,E(t.eventos,o=>(n(),u("div",{class:"items-center px-4 m-auto",key:o.id},[o.estado!="Cerrado"&&o.votantes!=null?(n(),u("div",le,[i("p",de,[k(f(o.nombre)+" ",1),ue,i("span",he,f(o.fecha_inicio)+" - "+f(o.fecha_fin),1),ce,t.votos.find(y=>y.id_eventos==o.id)?(n(),u("span",me," Usted ha votado por "+f(t.candidatos.find(y=>y.id==t.votos.find(B=>B.id_eventos==o.id).id_candidato).nombre),1)):b("",!0)]),o.estado=="Activo"&&!t.votos.find(y=>y.id_eventos==o.id)?(n(),U(W,{key:0,class:A(["md:text-base m-auto",{"opacity-25":s.isLoading}]),disabled:s.isLoading,href:s.route("votos.index",{tipo_evento:o.id,tipo_user:o.votantes?o.votantes.tipo:""})},{default:V(()=>[k(" Votar ")]),_:2},1032,["class","disabled","href"])):b("",!0)])):b("",!0)]))),128))])])):b("",!0),s.$page.props.user.roles.includes("Administrador")||s.$page.props.user.roles.includes("Supervisor")?(n(),u("div",ve,[t.eventos_admin.length?(n(),u("div",fe,[i("div",pe,[K(i("select",{id:"evento_selected",name:"evento_selected","onUpdate:modelValue":d[0]||(d[0]=o=>c.value=o),onChange:Y,class:"block w-full p-2 text-base text-gray-900 border border-gray-300 rounded-lg bg-gray-50 focus:ring-blue-500 focus:border-blue-500"},[ge,(n(!0),u(R,null,E(t.eventos_admin,o=>(n(),u("option",{class:"flex cursor mb-2 sm:mb-auto",key:o.id,value:o.id},f(o.nombre),9,be))),128))],544),[[O,c.value]])]),i("div",ye,[i("div",xe,[i("h2",we,[k(" Nivel de votaciones "),ke,k(" Total Votantes habilitados - "+f(m(p).votantes),1)]),w(m(X),{class:"flex justify-center mt-4",modelValue:m(p).votos,"onUpdate:modelValue":d[1]||(d[1]=o=>m(p).votos=o),size:200,max:m(p).votantes},null,8,["modelValue","max"])]),i("div",Me,[Ve,w(m(H),{type:"bar",data:l.value,options:a.value,class:"h-full m-2"},null,8,["data","options"])])])])):(n(),u("div",Re,[w(m(I),{severity:"info",sticky:s.sticky,class:"text-center w-fit",life:3e3},{default:V(()=>[k("Los eventos de votación activos serán mostrados en esta sección")]),_:1},8,["sticky"])]))])):b("",!0)]),_:1})],64))}};export{Se as default};
