import{x as D,T as P,r as q,q as z,w as S,c as f,o as _,b as a,u as t,Z as A,d as I,e as l,t as x,B as H,p as T,l as W,n as F,j as k,F as L,k as Z}from"./app-C6dctcvZ.js";import{_ as G}from"./AuthenticatedLayout-Caz0BetY.js";import{_ as d}from"./InputError-BY-6HwxO.js";import{_ as c}from"./InputLabel-aJOMCNbQ.js";import{_ as J}from"./PrimaryButton-C1a6B2as.js";import{_ as p}from"./TextInput-jjPobxJx.js";import{s as K}from"./index-9Pqismdn.js";import{r as Q}from"./PhotoIcon-fUvs8PSj.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./BreadCrumb-DuMHc6dP.js";import"./SecondaryButtonReturn-DppBX2pS.js";import"./XCircleIcon-EzHoHCs-.js";import"./index-DgxpZhfN.js";import"./index-Dq9Q2IfK.js";const X={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Y={class:"p-6 border-b border-gray-200"},ee={class:"sm:text-xl text-lg font-bold"},oe={class:"mt-2"},se={class:"bg-white p-4 rounded-lg shadow h-auto"},te={class:"flex justify-center items-center mt-4"},ae={class:"border-2 border-gray-300 rounded-md h-full"},le={class:"flex justify-center"},re=["src","alt"],ne={key:0,class:"flex justify-center mt-2"},ie={class:"bg-white p-4 rounded-lg shadow h-full"},de={class:"mt-4 flex flex-wrap gap-4"},ce={class:"mb-2"},ue={class:"mb-2 w-1/4"},me={class:"mb-2 w-full"},ve={key:0},_e={class:"mb-2 w-1/4"},pe={class:"mb-2 w-1/4"},fe={class:"mb-2 w-1/4"},be={class:"mb-2 w-1/4"},ge={class:""},we={class:"flex justify-center items-center w-full col-span-2 mt-4"},Le={__name:"SubirActa",props:{proyectos:Object,evento:Object,comuna:Number,puesto_votacion:Number,id_jurado:Number,eventos_hijos_vigentes:Object,actas_enviadas:Object,faltan_actas:Number},setup(g){const w=D("$swal"),u=g;console.log(u);const e=P({id_evento:u.eventos_hijos_vigentes[u.faltan_actas-1].id,id_jurado:u.id_jurado,comuna:u.comuna,puesto_votacion:u.puesto_votacion,fecha_evento:new Date().toLocaleDateString("en-CA"),votos_nulos:0,votos_blancos:0,votos_no_marcados:0,total_ciudadanos:0,total_votantes:0,observaciones:"",evidencia:null,votos_proyectos:{}}),m=q(null),h=q(!1),E=z(()=>{const o=e.observaciones.trim().length;return o>=250?h.value=!0:h.value=!1,o});S(E,()=>{e.observaciones=e.observaciones.trim()}),S([()=>e.votos_blancos,()=>e.votos_nulos,()=>e.votos_no_marcados,()=>e.votos_proyectos],()=>{const r=parseInt(e.votos_blancos)+parseInt(e.votos_nulos)+parseInt(e.votos_no_marcados),o=Object.values(e.votos_proyectos).reduce((s,v)=>parseInt(s)+parseInt(v||0),0);e.total_votantes=r+o},{deep:!0});const N=r=>(console.log(r),u.proyectos[r]||[]),O=r=>{const o=r.target.files[0];if(!o){m.value=null;return}const s=new FileReader;s.onload=v=>{const b=new Image;b.onload=()=>{const y=document.createElement("canvas"),M=y.getContext("2d"),V=1024,j=1024;let n=b.width,i=b.height;(n>V||i>j)&&(n>i?(i=Math.round(i*V/n),n=V):(n=Math.round(n*j/i),i=j)),y.width=n,y.height=i,M.drawImage(b,0,0,n,i),y.toBlob(U=>{if(U.size>2e6){Swal.fire({icon:"error",title:"Error",text:"Incluso comprimida, la imagen supera los 2MB."});return}const C=new File([U],o.name,{type:"image/jpeg",lastModified:Date.now()});m.value=URL.createObjectURL(C),e.evidencia=C},"image/jpeg",.8)},b.src=v.target.result},s.readAsDataURL(o)},B=()=>{e.evidencia=null,m.value=null},R=()=>{const r=parseInt(e.votos_blancos)+parseInt(e.votos_nulos)+parseInt(e.votos_no_marcados),o=Object.values(e.votos_proyectos).reduce((s,v)=>parseInt(s)+parseInt(v||0),0);if(console.log("Total votos:",r),console.log("Total proyectos:",o),console.log("Total ciudadanos:",e.total_ciudadanos),console.log("Total votantes:",e.total_votantes),parseInt(e.total_ciudadanos)!=parseInt(e.total_votantes)){w.fire({icon:"error",title:"Error",text:"El total de ciudadanos registrados debe ser igual al total de ciudadanos votantes"});return}else if(parseInt(e.total_votantes)!=r+parseInt(o)){w.fire({icon:"error",title:"Error",text:"El total de votantes debe ser igual a la suma de votos nulos, blancos, no marcados y votos por proyecto."});return}console.log(e),e.post(route("actaPresencial.store"),{onSuccess:()=>{w.fire({icon:"success",title:"Éxito",text:"Acta de escrutinio cargada correctamente."}),e.reset(),m.value=null},onError:s=>{console.error(s),w.fire({icon:"error",title:"Error",text:"Hubo un error al enviar el formulario. Por favor, verifica los datos e intenta nuevamente."})}})},$=[{url:"",text:"Carga acta de escrutinio"}];return(r,o)=>(_(),f(L,null,[a(t(A),{title:"Carga de acta"}),a(G,{breadCrumbLinks:$},{header:I(()=>o[8]||(o[8]=[k(" Carga acta de escrutinio y registros ")])),default:I(()=>[l("div",X,[l("div",Y,[l("h1",ee," Proceso de votación presencial física - "+x(g.eventos_hijos_vigentes[0].nombre),1),l("p",oe,x(g.faltan_actas)+" actas por enviar",1)]),l("form",{onSubmit:H(R,["prevent"]),class:"md:grid md:grid-cols-2 gap-4 p-6"},[l("div",se,[o[9]||(o[9]=l("h2",{class:"text-lg font-semibold mb-4"}," Subir acta de escrutinio ",-1)),o[10]||(o[10]=l("p",null,"Sube el acta de escrutinio en formato imagen.",-1)),l("div",te,[l("div",ae,[a(p,{id:"evidencia",type:"file",class:"!border-0",accept:"image/*",required:"",onInput:o[0]||(o[0]=s=>O(s)),maxFileSize:2e6}),a(d,{class:"mt-2",message:t(e).errors.evidencia},null,8,["message"]),l("div",le,[m.value?(_(),f("img",{key:0,src:m.value,alt:t(e).evidencia,class:"w-4/6 h-full object-contain"},null,8,re)):(_(),W(t(Q),{key:1,class:"w-2/6 text-gray-300 flex justify-center items-center"}))]),m.value?(_(),f("div",ne,[l("button",{onClick:o[1]||(o[1]=s=>B()),type:"button",class:"bg-red-500 text-white px-4 py-2 rounded"}," Eliminar Imagen ")])):T("",!0)])])]),l("div",ie,[o[12]||(o[12]=l("h2",{class:"text-lg font-semibold mb-4"}," Registro de información ",-1)),l("div",de,[l("div",ce,[a(c,{for:"fecha_evento",value:"Fecha del evento"}),a(p,{id:"fecha_evento",modelValue:t(e).fecha_evento,"onUpdate:modelValue":o[2]||(o[2]=s=>t(e).fecha_evento=s),class:"mt-1 block w-full",type:"date",required:""},null,8,["modelValue"]),a(d,{message:t(e).errors.fecha_evento,class:"mt-2"},null,8,["message"])]),l("div",ue,[a(c,{for:"total_ciudadanos",value:"Total ciudadanos registrados"}),a(p,{id:"total_ciudadanos",modelValue:t(e).total_ciudadanos,"onUpdate:modelValue":o[3]||(o[3]=s=>t(e).total_ciudadanos=s),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),a(d,{message:t(e).errors.total_ciudadanos,class:"mt-2"},null,8,["message"])]),l("div",me,[a(c,{for:"observaciones",value:"Observaciones (max 250 caracteres)"}),a(t(K),{modelValue:t(e).observaciones,"onUpdate:modelValue":o[4]||(o[4]=s=>t(e).observaciones=s),variant:"filled",autoResize:"",rows:"5",class:"mt-1 block w-full",required:"",autocomplete:"observaciones"},null,8,["modelValue"]),l("p",{class:F(["text-gray-500 text-sm mt-2",{"text-red-500":h.value}])},[k(x(E.value)+" caracteres ",1),h.value?(_(),f("span",ve,"Limite de caracteres superado")):T("",!0)],2),a(d,{message:t(e).errors.observaciones,class:"mt-2"},null,8,["message"])]),o[11]||(o[11]=l("div",{class:"w-full"},[l("h2",null,"Registro de votos")],-1)),l("div",_e,[a(c,{for:"votos_blancos",value:"Votos blancos"}),a(p,{id:"votos_blancos",modelValue:t(e).votos_blancos,"onUpdate:modelValue":o[5]||(o[5]=s=>t(e).votos_blancos=s),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),a(d,{message:t(e).errors.votos_blancos,class:"mt-2"},null,8,["message"])]),l("div",pe,[a(c,{for:"votos_no_marcados",value:"Votos no marcados"}),a(p,{id:"votos_no_marcados",modelValue:t(e).votos_no_marcados,"onUpdate:modelValue":o[6]||(o[6]=s=>t(e).votos_no_marcados=s),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),a(d,{message:t(e).errors.votos_no_marcados,class:"mt-2"},null,8,["message"])]),l("div",fe,[a(c,{for:"votos_nulos",value:"Votos nulos"}),a(p,{id:"votos_nulos",modelValue:t(e).votos_nulos,"onUpdate:modelValue":o[7]||(o[7]=s=>t(e).votos_nulos=s),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),a(d,{message:t(e).errors.votos_nulos,class:"mt-2"},null,8,["message"])]),(_(!0),f(L,null,Z(N(g.eventos_hijos_vigentes[0].id),s=>(_(),f("div",{key:s.id,class:"mb-2 w-full"},[a(c,{for:"votos_proyecto_"+s.id,value:"Votos proyecto --"+s.numero_tarjeton+" "+s.nombre},null,8,["for","value"]),a(p,{id:"votos_proyecto_"+s.id,modelValue:t(e).votos_proyectos[s.id],"onUpdate:modelValue":v=>t(e).votos_proyectos[s.id]=v,class:"mt-1 block w-full",type:"number",required:""},null,8,["id","modelValue","onUpdate:modelValue"]),a(d,{message:t(e).errors["votos_proyectos."+s.id],class:"mt-2"},null,8,["message"])]))),128)),l("div",be,[a(c,{for:"total_votos",value:"Total votantes"}),l("b",ge,x(t(e).total_votantes),1)])])]),l("div",we,[a(J,{class:F(["w-auto",{"opacity-25":t(e).processing}]),disabled:t(e).processing},{default:I(()=>o[13]||(o[13]=[k(" Enviar ")])),_:1},8,["class","disabled"])])],32)])]),_:1})],64))}};export{Le as default};
