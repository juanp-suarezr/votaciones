import{x as Q,T as X,Q as v,r as c,w as Z,c as l,o as r,b as n,u as s,Z as H,d as k,e as a,p as B,f as g,F as V,k as j,t as h,v as q,g as J,n as M,E as U,j as R,z as W}from"./app-DoCB3NJv.js";import{_ as ee}from"./AuthenticatedLayout-CxF_NIAb.js";import{b as oe,s as T,t as te,e as se,c as ae}from"./etnia-CWIBbV1-.js";import{_ as p}from"./InputError-B8J605Ke.js";import{_ as m}from"./InputLabel-Cu8k-yD1.js";import{_ as ie}from"./PrimaryButton-REPUDOSK.js";import{_ as ne}from"./Modal-CAgIIN5K.js";import{_ as w}from"./TextInput-D6eL9GvO.js";import{s as le}from"./index-BfEyGZM_.js";import{s as re}from"./index-Cc-1FUjv.js";import"./index-ALJPZmh-.js";import"./index-gOH8BnBs.js";import"./index-DrM59tS2.js";import"./SecondaryButtonReturn-BGBuvs-4.js";import"./XCircleIcon-BWdpXU44.js";import"./index-DtNmghqB.js";import"./index-CEVDT9FK.js";import"./index-Ce1dr1p9.js";import"./index-BSN1LpXQ.js";const de={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ce={class:"mt-4 justify-center"},ue={class:"m-auto py-4 px-4"},me={key:0,class:"sm:grid sm:grid-cols-2 gap-6 h-full"},pe={class:"mb-2"},fe=["value"],ve={class:"mb-2"},ge={class:"col-span-2 flex justify-end"},be=["disabled"],xe={key:1,class:"sm:grid sm:grid-cols-2 gap-6"},ye={class:"mb-2"},we={class:"mb-2"},_e={key:0,class:"text-red-500"},ke={class:"mb-2"},Ve={class:"mt-2 block sm:flex"},he={class:""},Ce={class:"sm:ms-6"},$e={key:0,class:"sm:ms-6"},Se={key:1,class:"sm:ms-6"},Ee={class:"mb-2"},Be=["value"],je={class:"mb-2"},qe=["value"],Ue={class:"mb-2"},Ie={class:"mb-2"},Ne={class:"col-span-2 flex justify-between gap-2"},De={class:"flex pt-4 justify-end"},Me={class:"flex pt-4 justify-end h-full"},Re={class:"flex justify-center my-12"},ao={__name:"Registro",setup(Te){const b=Q("$swal"),F=[{url:"",text:"Registro votantes"}],e=X({nombre:"",identificacion:"",tipo_documento:"",nacimiento:"",comuna:v().props.user.jurado.comuna,id_jurado:v().props.user.jurado.id,id_evento:v().props.user.jurado.evento.id,genero:"",etnia:"",condicion:"",direccion:"",barrio:""}),x=c(!1),O=c([{label:"Validación previa"},{label:"Información"}]),K=c([{label:"paso 1"},{label:"paso 2"}]),u=c(0),f=c(""),y=c(""),d=c(!1),_=c(!1);c(!1),c("");const C=c([]);C.value=oe.find(i=>i.id===parseInt(v().props.user.jurado.comuna)).barrios,console.log(C.value),Z(_,i=>{i&&(e.genero="")});const L=i=>{if(!i)return"";const o=new Date(i),t=o.getFullYear(),$=String(o.getMonth()+1).padStart(2,"0"),S=String(o.getDate()).padStart(2,"0");return`${t}-${$}-${S}`},z=i=>{u.value=i,d.value=!0},A=()=>{if(!e.nacimiento)return y.value="Debes ingresar la fecha de nacimiento.",!1;const i=new Date,o=e.nacimiento,[t,$,S]=o.split("-").map(Number);let D=i.getFullYear()-t;const E=i.getMonth()-($-1);return console.log(i.getMonth()),console.log(E),console.log(i.getDate()),(E<0||E===0&&i.getDate()<S)&&D--,D<14?(y.value="No cumple con el requisito de edad mínima (14 años), por lo tanto, no puede ejercer el derecho al voto.",!1):(y.value="",!0)},G=async()=>{if(d.value=!1,x.value=!0,e.identificacion&&e.tipo_documento){f.value="",console.log(v().props);try{const i=await P(e.identificacion);if(console.log("Identificación data:",i),x.value=!1,i.existe){if(f.value="La identificación ya está registrada.",i.votante&&i.votante.votos.length>0)f.value+=" Y el votante ya ha emitido su voto en las elecciones.",await b.fire({title:"Registro encontrado",html:f.value,icon:"warning",confirmButtonText:"Cerrar!",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl",cancelButton:"!text-2xl"}});else{console.log(i),(await b.fire({title:"Registro encontrado",html:`
    <p class="!text-2xl">Votante: <strong>${i.votante.nombre}</strong></p>
    <p class="!text-2xl">Identificación: <strong>${i.votante.identificacion}</strong></p>
        <p class="!text-2xl">Es tu momento de votar</p>`,icon:"success",showCancelButton:!0,confirmButtonText:"Aceptar datos y votar!",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl",cancelButton:"!text-2xl"}})).isConfirmed&&(window.location.href=route("votacionPresencial.eventos",{id_votante:i.votante.id}));return}d.value=!1}else f.value="",d.value=!0}catch{f.value="Error al validar la identificación. Intenta de nuevo.",d.value=!1}}d.value?u.value=1:(x.value=!1,(!e.identificacion||f.value!="")&&(e.errors.identificacion=f.value||"Este campo es requerido."),e.tipo_documento||(e.errors.tipo_documento="Este campo es requerido."))},P=async i=>{const o=await W.post("/validar-identificacion-presencial",{identificacion:i,registro_presencial:!0});return console.log(o.data),o.data},I=i=>{switch(d.value=!1,i){case 1:G();break;case 2:N();break}d.value&&(u.value=i)},N=()=>{if(d.value=!1,e.nombre&&e.nacimiento&&e.genero&&e.etnia&&e.condicion&&e.barrio&&e.direccion){if(d.value=!0,!A())return;Y()}d.value||(e.nombre||(e.errors.nombre="Este campo es requerido."),e.nacimiento||(e.errors.nacimiento="Este campo es requerido."),e.genero||(e.errors.genero="Este campo es requerido."),e.etnia||(e.errors.etnia="Este campo es requerido."),e.condicion||(e.errors.condicion="Este campo es requerido."),e.barrio||(e.errors.barrio="Este campo es requerido."),e.direccion||(e.errors.direccion="Este campo es requerido."))},Y=async()=>{(await b.fire({title:"Información de Registro",html:`
    <p class="!text-2xl">El votante es: <strong>${e.nombre}</strong></p>
    <p class="!text-2xl">Identificación: <strong>${e.tipo_documento} - ${e.identificacion}</strong></p>
    <p class="!text-2xl">Fecha nacimiento: <strong>${L(e.nacimiento)}</strong></p>
    <p class="!text-2xl">Identidad de genero: <strong>${e.genero}</strong></p>
    <p class="!text-2xl">Grupo poblacional: <strong>${e.etnia}</strong></p>
    <p class="!text-2xl">Condición Poblacional: <strong>${e.condicion}</strong></p>
    <p class="!text-2xl">Barrio/Vereda: <strong>${e.barrio}</strong></p>
    <p class="!text-2xl">Dirección: <strong>${e.direccion}</strong></p>`,icon:"success",showCancelButton:!0,confirmButtonText:"Aceptar datos y continuar!",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl",cancelButton:"!text-2xl"}})).isConfirmed&&e.post(route("votantesPresencial.store"),{onSuccess:()=>{b({title:"Registro realizado",html:`
    <p class="!text-2xl"><strong>${e.nombre}</strong> Ahora es tu turno de votar</p>`,icon:"success",confirmButtonText:"Votar",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl"}}).then(o=>{window.location.href=route("votacionPresencial.eventos",{id_votante:v().props.flash.success.id_votante})})},onError:o=>{b({title:"Error",text:"Ocurrió un error al registrar el votante.",icon:"error"}).then(t=>{u.value=0}),console.error(o)}})};return(i,o)=>(r(),l(V,null,[n(s(H),{title:"Registro votantes"}),n(ee,{breadCrumbLinks:F},{header:k(()=>o[17]||(o[17]=[R(" Registro de votante ")])),default:k(()=>[a("div",de,[o[25]||(o[25]=a("div",{class:"p-6 border-b border-gray-200"},[a("h1",null,"Registro votante")],-1)),a("div",ce,[n(s(T),{class:"hidden sm:block",model:O.value,activeStep:u.value,"onUpdate:activeStep":o[0]||(o[0]=t=>u.value=t)},null,8,["model","activeStep"]),n(s(T),{class:"sm:hidden block",model:K.value,activeStep:u.value,"onUpdate:activeStep":o[1]||(o[1]=t=>u.value=t)},null,8,["model","activeStep"])]),a("form",ue,[u.value==0?(r(),l("div",me,[a("div",pe,[n(m,{for:"tipo_documento",value:"Tipo de Documento"}),g(a("select",{id:"tipo_documento","onUpdate:modelValue":o[2]||(o[2]=t=>s(e).tipo_documento=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[18]||(o[18]=a("option",{value:"",disabled:""},"Seleccione tipo de documento",-1)),(r(!0),l(V,null,j(s(te),t=>(r(),l("option",{key:t.id,value:t.nombre},h(t.nombre),9,fe))),128))],512),[[q,s(e).tipo_documento]]),n(p,{class:"mt-2",message:s(e).errors.tipo_documento},null,8,["message"])]),a("div",ve,[n(m,{for:"identificacion",value:"Identificación"}),n(w,{id:"identificacion",type:"text",class:"mt-1 block w-full",modelValue:s(e).identificacion,"onUpdate:modelValue":o[3]||(o[3]=t=>s(e).identificacion=t),onKeydown:o[4]||(o[4]=J(t=>I(1),["enter"])),required:""},null,8,["modelValue"]),n(p,{class:"mt-2",message:s(e).errors.identificacion},null,8,["message"])]),a("div",ge,[a("button",{type:"button",class:M(["bg-secondary hover:bg-primary text-xs sm:text-sm text-white p-2 rounded-md shadow-xl",{"opacity-25":x.value}]),onClick:o[5]||(o[5]=t=>I(1)),disabled:x.value}," Siguiente ",10,be)])])):B("",!0),u.value==1?(r(),l("div",xe,[a("div",ye,[n(m,{for:"nombre",value:"Nombre Completo"}),n(w,{id:"nombre",type:"text",class:"mt-1 block w-full",modelValue:s(e).nombre,"onUpdate:modelValue":o[6]||(o[6]=t=>s(e).nombre=t),required:""},null,8,["modelValue"]),n(p,{class:"mt-2",message:s(e).errors.nombre},null,8,["message"])]),a("div",we,[n(m,{for:"nacimiento",value:"Fecha de Nacimiento"}),n(w,{id:"nacimiento",type:"date",class:"mt-1 block w-full",modelValue:s(e).nacimiento,"onUpdate:modelValue":o[7]||(o[7]=t=>s(e).nacimiento=t),required:""},null,8,["modelValue"]),n(p,{class:"mt-2",message:s(e).errors.nacimiento},null,8,["message"]),y.value?(r(),l("p",_e,h(y.value),1)):B("",!0)]),a("div",ke,[n(m,{for:"genero",value:"Identidad de Género"}),a("div",Ve,[a("div",he,[g(a("input",{type:"radio",id:"masculino",value:"Masculino","onUpdate:modelValue":o[8]||(o[8]=t=>s(e).genero=t)},null,512),[[U,s(e).genero]]),o[19]||(o[19]=a("label",{class:"ps-2 text-sm sm:text-base",for:"masculino"},"Masculino",-1))]),a("div",Ce,[g(a("input",{type:"radio",id:"two",value:"Femenino","onUpdate:modelValue":o[9]||(o[9]=t=>s(e).genero=t)},null,512),[[U,s(e).genero]]),o[20]||(o[20]=a("label",{class:"ps-2 text-sm sm:text-base",for:"two"},"Femenino",-1))]),_.value?(r(),l("div",$e,[n(m,{class:"sm:text-sm text-xs",for:"genero",value:"¿Cual?"}),n(w,{id:"genero",type:"text",class:"mt-1 block w-full p-0 sm:p-1",modelValue:s(e).genero,"onUpdate:modelValue":o[10]||(o[10]=t=>s(e).genero=t),autocomplete:"genero"},null,8,["modelValue"]),n(p,{class:"mt-1",message:s(e).errors.genero},null,8,["message"])])):(r(),l("div",Se,[g(a("input",{type:"radio",id:"tres",value:"true","onUpdate:modelValue":o[11]||(o[11]=t=>_.value=t)},null,512),[[U,_.value]]),o[21]||(o[21]=a("label",{class:"ps-2 text-sm sm:text-base",for:"tres"},"Otro",-1))]))])]),a("div",Ee,[n(m,{for:"etnia",value:"Grupo poblacional"}),g(a("select",{id:"etnia","onUpdate:modelValue":o[12]||(o[12]=t=>s(e).etnia=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[22]||(o[22]=a("option",{value:"",disabled:""}," Seleccione grupo poblacional perteneciente ",-1)),(r(!0),l(V,null,j(s(se),t=>(r(),l("option",{key:t.id,value:t.nombre},h(t.nombre),9,Be))),128))],512),[[q,s(e).etnia]]),n(p,{class:"mt-2",message:s(e).errors.etnia},null,8,["message"])]),a("div",je,[n(m,{for:"condicion",value:"Condición poblacional"}),g(a("select",{id:"condicion","onUpdate:modelValue":o[13]||(o[13]=t=>s(e).condicion=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[23]||(o[23]=a("option",{value:"",disabled:""}," Seleccione condición poblacional ",-1)),(r(!0),l(V,null,j(s(ae),t=>(r(),l("option",{key:t.id,value:t.nombre},h(t.nombre),9,qe))),128))],512),[[q,s(e).condicion]]),n(p,{class:"mt-2",message:s(e).errors.condicion},null,8,["message"])]),a("div",Ue,[n(m,{for:"barrio",value:"Barrio/Vereda"}),n(s(le),{id:"barrio",modelValue:s(e).barrio,"onUpdate:modelValue":o[14]||(o[14]=t=>s(e).barrio=t),options:C.value,filter:"",placeholder:"Seleccione barrio/vereda de dirección",checkmark:"",highlightOnSelect:!1,class:"w-full"},null,8,["modelValue","options"]),n(p,{class:"mt-2",message:s(e).errors.barrio},null,8,["message"])]),a("div",Ie,[n(m,{for:"direccion",value:"Dirección"}),n(w,{id:"direccion",type:"text",class:"mt-1 block w-full",modelValue:s(e).direccion,"onUpdate:modelValue":o[15]||(o[15]=t=>s(e).direccion=t),required:""},null,8,["modelValue"]),n(p,{class:"mt-2",message:s(e).errors.direccion},null,8,["message"])]),a("div",Ne,[a("div",De,[a("button",{type:"button",onClick:o[16]||(o[16]=t=>z(0)),class:"bg-secondary hover:bg-primary text-xs sm:text-sm text-white px-4 rounded-md shadow-xl"}," Atrás ")]),a("div",Me,[n(ie,{type:"button",class:M(["h-full",{"opacity-25":s(e).processing}]),onClick:N,disabled:s(e).processing},{default:k(()=>o[24]||(o[24]=[R(" Siguiente ")])),_:1},8,["class","disabled"])])])])):B("",!0)])])]),_:1}),n(ne,{show:i.loadingModal,closeable:!1},{default:k(()=>[o[26]||(o[26]=a("h2",{class:"py-4 text-2xl font-semibold text-gray-800 flex tex-center justify-center bg-azul text-white"}," Cargando datos... ",-1)),a("div",Re,[n(s(re),{"aria-label":"Loading"})])]),_:1},8,["show"])],64))}};export{ao as default};
