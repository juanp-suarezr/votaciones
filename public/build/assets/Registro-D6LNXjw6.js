import{k as Q,T as X,Q as l,r as u,w as Z,a as r,b as d,d as n,u as s,Z as H,e as h,f as a,l as E,g,F as k,h as j,t as V,v as q,U as J,n as M,B as U,j as R,q as W}from"./app-CN-tHd9G.js";import{_ as ee}from"./AuthenticatedLayout-DML6eDrr.js";import{b as oe,s as T,t as te,e as se,c as ae}from"./etnia-CbkbE5CN.js";import{_ as v}from"./InputError-DoeFkVaq.js";import{_ as p}from"./InputLabel-B9KJF_lk.js";import{_ as ie}from"./PrimaryButton-1QIgKzLF.js";import{_ as ne}from"./Modal-mPY_RG_B.js";import{_ as y}from"./TextInput-lq1v4oY_.js";import{s as le}from"./index-y1qE1Fez.js";import{s as re}from"./index-CdlIJJzy.js";import"./index-Bo6AOBCx.js";import"./index-D15RmusN.js";import"./index-C4SJJAwk.js";import"./SecondaryButtonReturn-CJXDO7J0.js";import"./XCircleIcon-DRJkK2wK.js";import"./index-ncQ8hgaa.js";import"./index-CCXs0q_C.js";import"./index-D-RszuUv.js";import"./index-DNUcfqfj.js";const de={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ce={class:"mt-4 justify-center"},ue={class:"m-auto py-4 px-4"},me={key:0,class:"sm:grid sm:grid-cols-2 gap-6 h-full"},pe={class:"mb-2"},ve=["value"],fe={class:"mb-2"},ge={class:"col-span-2 flex justify-end"},be=["disabled"],xe={key:1,class:"sm:grid sm:grid-cols-2 gap-6"},_e={class:"mb-2"},ye={class:"mb-2"},we={key:0,class:"text-red-500"},he={class:"mb-2"},ke={class:"mt-2 block sm:flex"},Ve={class:""},Ce={class:"sm:ms-6"},$e={key:0,class:"sm:ms-6"},Se={key:1,class:"sm:ms-6"},Be={class:"mb-2"},Ee=["value"],je={class:"mb-2"},qe=["value"],Ue={class:"mb-2"},Ie={class:"mb-2"},Ne={class:"col-span-2 flex justify-between gap-2"},De={class:"flex pt-4 justify-end"},Me={class:"flex pt-4 justify-end h-full"},Re={class:"flex justify-center my-12"},ao={__name:"Registro",setup(Te){const b=Q("$swal"),F=[{url:"",text:"Registro votantes"}],e=X({nombre:"",identificacion:"",tipo_documento:"",nacimiento:"",comuna:l().props.user.jurado.comuna,id_jurado:l().props.user.jurado.id,id_evento:l().props.user.jurado.evento.id,genero:"",etnia:"",condicion:"",direccion:"",barrio:""}),x=u(!1),O=u([{label:"Validación previa"},{label:"Información"}]),K=u([{label:"paso 1"},{label:"paso 2"}]),m=u(0),f=u(""),_=u(""),c=u(!1),w=u(!1);u(!1),u("");const C=u([]);C.value=oe.find(i=>i.id===parseInt(l().props.user.jurado.comuna)).barrios,console.log(C.value),Z(w,i=>{i&&(e.genero="")});const L=i=>{if(!i)return"";const o=new Date(i),t=o.getFullYear(),$=String(o.getMonth()+1).padStart(2,"0"),S=String(o.getDate()).padStart(2,"0");return`${t}-${$}-${S}`},A=i=>{m.value=i,c.value=!0},G=()=>{if(!e.nacimiento)return _.value="Debes ingresar la fecha de nacimiento.",!1;const i=new Date,o=e.nacimiento,[t,$,S]=o.split("-").map(Number);let D=i.getFullYear()-t;const B=i.getMonth()-($-1);return console.log(i.getMonth()),console.log(B),console.log(i.getDate()),(B<0||B===0&&i.getDate()<S)&&D--,D<14?(_.value="No cumple con el requisito de edad mínima (14 años), por lo tanto, no puede ejercer el derecho al voto.",!1):(_.value="",!0)},z=async()=>{if(c.value=!1,x.value=!0,e.identificacion&&e.tipo_documento){f.value="",console.log(l().props);try{const i=await Y(e.identificacion);if(console.log("Identificación data:",i),x.value=!1,i.existe){if(f.value="La identificación ya está registrada.",i.votante&&i.votante.votos.length>0)f.value+=" Y el votante ya ha emitido su voto en las elecciones.",await b.fire({title:"Registro encontrado",html:f.value,icon:"warning",confirmButtonText:"Cerrar!",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl",cancelButton:"!text-2xl"}});else{console.log(i),(await b.fire({title:"Registro encontrado",html:`
    <p class="!text-2xl">Votante: <strong>${i.votante.nombre}</strong></p>
    <p class="!text-2xl">Identificación: <strong>${i.votante.identificacion}</strong></p>
        <p class="!text-2xl">Es tu momento de votar</p>`,icon:"success",showCancelButton:!0,confirmButtonText:"Aceptar datos y votar!",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl",cancelButton:"!text-2xl"}})).isConfirmed&&(window.location.href=route("votos.index",{id_votante:i.votante.id,evento:l().props.user.jurado.evento.id,tipo_evento:l().props.user.jurado.evento.tipos,tipo_user:i.votante.hash_votantes.length!==0?i.votante.hash_votantes[0].tipo:"",subtipo_user:i.votante.hash_votantes.length!==0?i.votante.hash_votantes[0].subtipo:""}));return}c.value=!1}else f.value="",c.value=!0}catch{f.value="Error al validar la identificación. Intenta de nuevo.",c.value=!1}}c.value?m.value=1:(x.value=!1,(!e.identificacion||f.value!="")&&(e.errors.identificacion=f.value||"Este campo es requerido."),e.tipo_documento||(e.errors.tipo_documento="Este campo es requerido."))},Y=async i=>{const o=await W.post("/validar-identificacion-presencial",{identificacion:i,registro_presencial:!0});return console.log(o.data),o.data},I=i=>{switch(c.value=!1,i){case 1:z();break;case 2:N();break}c.value&&(m.value=i)},N=()=>{if(c.value=!1,e.nombre&&e.nacimiento&&e.genero&&e.etnia&&e.condicion&&e.barrio&&e.direccion){if(c.value=!0,!G())return;P()}c.value||(e.nombre||(e.errors.nombre="Este campo es requerido."),e.nacimiento||(e.errors.nacimiento="Este campo es requerido."),e.genero||(e.errors.genero="Este campo es requerido."),e.etnia||(e.errors.etnia="Este campo es requerido."),e.condicion||(e.errors.condicion="Este campo es requerido."),e.barrio||(e.errors.barrio="Este campo es requerido."),e.direccion||(e.errors.direccion="Este campo es requerido."))},P=async()=>{(await b.fire({title:"Información de Registro",html:`
    <p class="!text-2xl">El votante es: <strong>${e.nombre}</strong></p>
    <p class="!text-2xl">Identificación: <strong>${e.tipo_documento} - ${e.identificacion}</strong></p>
    <p class="!text-2xl">Fecha nacimiento: <strong>${L(e.nacimiento)}</strong></p>
    <p class="!text-2xl">Identidad de genero: <strong>${e.genero}</strong></p>
    <p class="!text-2xl">Grupo poblacional: <strong>${e.etnia}</strong></p>
    <p class="!text-2xl">Condición Poblacional: <strong>${e.condicion}</strong></p>
    <p class="!text-2xl">Barrio/Vereda: <strong>${e.barrio}</strong></p>
    <p class="!text-2xl">Dirección: <strong>${e.direccion}</strong></p>`,icon:"success",showCancelButton:!0,confirmButtonText:"Aceptar datos y continuar!",cancelButtonText:"Cancelar",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl",cancelButton:"!text-2xl"}})).isConfirmed&&e.post(route("votantesPresencial.store"),{onSuccess:()=>{b({title:"Registro realizado",html:`
    <p class="!text-2xl"><strong>${e.nombre}</strong> Ahora es tu turno de votar</p>`,icon:"success",confirmButtonText:"Votar",allowOutsideClick:!1,allowEscapeKey:!1,draggable:!0,customClass:{title:"!text-4xl",popup:"p-6",confirmButton:"!text-2xl"}}).then(o=>{window.location.href=route("votos.index",{id_votante:l().props.flash.success.id_votante,evento:l().props.user.jurado.evento.id,tipo_evento:l().props.user.jurado.evento.tipos,tipo_user:l().props.flash.success.hash_votante.tipo,subtipo_user:l().props.flash.success.hash_votante.subtipo})})},onError:o=>{b({title:"Error",text:"Ocurrió un error al registrar el votante.",icon:"error"}).then(t=>{m.value=0}),console.error(o)}})};return(i,o)=>(d(),r(k,null,[n(s(H),{title:"Registro votantes"}),n(ee,{breadCrumbLinks:F},{header:h(()=>o[17]||(o[17]=[R(" Registro de votante ")])),default:h(()=>[a("div",de,[o[25]||(o[25]=a("div",{class:"p-6 border-b border-gray-200"},[a("h1",null,"Registro votante")],-1)),a("div",ce,[n(s(T),{class:"hidden sm:block",model:O.value,activeStep:m.value,"onUpdate:activeStep":o[0]||(o[0]=t=>m.value=t)},null,8,["model","activeStep"]),n(s(T),{class:"sm:hidden block",model:K.value,activeStep:m.value,"onUpdate:activeStep":o[1]||(o[1]=t=>m.value=t)},null,8,["model","activeStep"])]),a("form",ue,[m.value==0?(d(),r("div",me,[a("div",pe,[n(p,{for:"tipo_documento",value:"Tipo de Documento"}),g(a("select",{id:"tipo_documento","onUpdate:modelValue":o[2]||(o[2]=t=>s(e).tipo_documento=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[18]||(o[18]=a("option",{value:"",disabled:""},"Seleccione tipo de documento",-1)),(d(!0),r(k,null,j(s(te),t=>(d(),r("option",{key:t.id,value:t.nombre},V(t.nombre),9,ve))),128))],512),[[q,s(e).tipo_documento]]),n(v,{class:"mt-2",message:s(e).errors.tipo_documento},null,8,["message"])]),a("div",fe,[n(p,{for:"identificacion",value:"Identificación"}),n(y,{id:"identificacion",type:"text",class:"mt-1 block w-full",modelValue:s(e).identificacion,"onUpdate:modelValue":o[3]||(o[3]=t=>s(e).identificacion=t),onKeydown:o[4]||(o[4]=J(t=>I(1),["enter"])),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:s(e).errors.identificacion},null,8,["message"])]),a("div",ge,[a("button",{type:"button",class:M(["bg-secondary hover:bg-primary text-xs sm:text-sm text-white p-2 rounded-md shadow-xl",{"opacity-25":x.value}]),onClick:o[5]||(o[5]=t=>I(1)),disabled:x.value}," Siguiente ",10,be)])])):E("",!0),m.value==1?(d(),r("div",xe,[a("div",_e,[n(p,{for:"nombre",value:"Nombre Completo"}),n(y,{id:"nombre",type:"text",class:"mt-1 block w-full",modelValue:s(e).nombre,"onUpdate:modelValue":o[6]||(o[6]=t=>s(e).nombre=t),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:s(e).errors.nombre},null,8,["message"])]),a("div",ye,[n(p,{for:"nacimiento",value:"Fecha de Nacimiento"}),n(y,{id:"nacimiento",type:"date",class:"mt-1 block w-full",modelValue:s(e).nacimiento,"onUpdate:modelValue":o[7]||(o[7]=t=>s(e).nacimiento=t),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:s(e).errors.nacimiento},null,8,["message"]),_.value?(d(),r("p",we,V(_.value),1)):E("",!0)]),a("div",he,[n(p,{for:"genero",value:"Identidad de Género"}),a("div",ke,[a("div",Ve,[g(a("input",{type:"radio",id:"masculino",value:"Masculino","onUpdate:modelValue":o[8]||(o[8]=t=>s(e).genero=t)},null,512),[[U,s(e).genero]]),o[19]||(o[19]=a("label",{class:"ps-2 text-sm sm:text-base",for:"masculino"},"Masculino",-1))]),a("div",Ce,[g(a("input",{type:"radio",id:"two",value:"Femenino","onUpdate:modelValue":o[9]||(o[9]=t=>s(e).genero=t)},null,512),[[U,s(e).genero]]),o[20]||(o[20]=a("label",{class:"ps-2 text-sm sm:text-base",for:"two"},"Femenino",-1))]),w.value?(d(),r("div",$e,[n(p,{class:"sm:text-sm text-xs",for:"genero",value:"¿Cual?"}),n(y,{id:"genero",type:"text",class:"mt-1 block w-full p-0 sm:p-1",modelValue:s(e).genero,"onUpdate:modelValue":o[10]||(o[10]=t=>s(e).genero=t),autocomplete:"genero"},null,8,["modelValue"]),n(v,{class:"mt-1",message:s(e).errors.genero},null,8,["message"])])):(d(),r("div",Se,[g(a("input",{type:"radio",id:"tres",value:"true","onUpdate:modelValue":o[11]||(o[11]=t=>w.value=t)},null,512),[[U,w.value]]),o[21]||(o[21]=a("label",{class:"ps-2 text-sm sm:text-base",for:"tres"},"Otro",-1))]))])]),a("div",Be,[n(p,{for:"etnia",value:"Grupo poblacional"}),g(a("select",{id:"etnia","onUpdate:modelValue":o[12]||(o[12]=t=>s(e).etnia=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[22]||(o[22]=a("option",{value:"",disabled:""}," Seleccione grupo poblacional perteneciente ",-1)),(d(!0),r(k,null,j(s(se),t=>(d(),r("option",{key:t.id,value:t.nombre},V(t.nombre),9,Ee))),128))],512),[[q,s(e).etnia]]),n(v,{class:"mt-2",message:s(e).errors.etnia},null,8,["message"])]),a("div",je,[n(p,{for:"condicion",value:"Condición poblacional"}),g(a("select",{id:"condicion","onUpdate:modelValue":o[13]||(o[13]=t=>s(e).condicion=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[23]||(o[23]=a("option",{value:"",disabled:""}," Seleccione condición poblacional ",-1)),(d(!0),r(k,null,j(s(ae),t=>(d(),r("option",{key:t.id,value:t.nombre},V(t.nombre),9,qe))),128))],512),[[q,s(e).condicion]]),n(v,{class:"mt-2",message:s(e).errors.condicion},null,8,["message"])]),a("div",Ue,[n(p,{for:"barrio",value:"Barrio/Vereda"}),n(s(le),{id:"barrio",modelValue:s(e).barrio,"onUpdate:modelValue":o[14]||(o[14]=t=>s(e).barrio=t),options:C.value,filter:"",placeholder:"Seleccione barrio/vereda de dirección",checkmark:"",highlightOnSelect:!1,class:"w-full"},null,8,["modelValue","options"]),n(v,{class:"mt-2",message:s(e).errors.barrio},null,8,["message"])]),a("div",Ie,[n(p,{for:"direccion",value:"Dirección"}),n(y,{id:"direccion",type:"text",class:"mt-1 block w-full",modelValue:s(e).direccion,"onUpdate:modelValue":o[15]||(o[15]=t=>s(e).direccion=t),required:""},null,8,["modelValue"]),n(v,{class:"mt-2",message:s(e).errors.direccion},null,8,["message"])]),a("div",Ne,[a("div",De,[a("button",{type:"button",onClick:o[16]||(o[16]=t=>A(0)),class:"bg-secondary hover:bg-primary text-xs sm:text-sm text-white px-4 rounded-md shadow-xl"}," Atrás ")]),a("div",Me,[n(ie,{type:"button",class:M(["h-full",{"opacity-25":s(e).processing}]),onClick:N,disabled:s(e).processing},{default:h(()=>o[24]||(o[24]=[R(" Siguiente ")])),_:1},8,["class","disabled"])])])])):E("",!0)])])]),_:1}),n(ne,{show:i.loadingModal,closeable:!1},{default:h(()=>[o[26]||(o[26]=a("h2",{class:"py-4 text-2xl font-semibold text-gray-800 flex tex-center justify-center bg-azul text-white"}," Cargando datos... ",-1)),a("div",Re,[n(s(re),{"aria-label":"Loading"})])]),_:1},8,["show"])],64))}};export{ao as default};
