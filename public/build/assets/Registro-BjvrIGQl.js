import{x as P,T as Q,Q as u,r as p,w as Z,a as n,b as r,d as i,u as s,Z as H,e as w,f as a,m as j,g as b,F as h,h as S,t as k,v as E,n as $,z as q,j as M,k as J}from"./app-DOYI1U6D.js";import{_ as K}from"./AuthenticatedLayout-BRW6EkAx.js";import{s as R,t as W,e as X,c as ee,a as oe}from"./etnia-C5ExNw1v.js";import{_ as v}from"./InputError-CP9FFbd1.js";import{_ as m}from"./InputLabel-B9-NaScZ.js";import{_ as te}from"./PrimaryButton-ChPurnI9.js";import{_ as se}from"./Modal-B7eN-I1P.js";import{_ as g}from"./TextInput-BAXUyalF.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./index-CB3L_rGE.js";const ae={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},ie={class:"mt-4 justify-center"},le={class:"m-auto py-4 px-4"},ne={key:0,class:"sm:grid sm:grid-cols-2 gap-6 h-full"},re={class:"mb-2"},de=["value"],ue={class:"mb-2"},ce={class:"col-span-2 flex justify-end"},me=["disabled"],pe={key:1,class:"sm:grid sm:grid-cols-2 gap-6"},ve={class:"mb-2"},fe={class:"mb-2"},be={key:0,class:"text-red-500"},ge={class:"mb-2"},_e={class:"mt-2 block sm:flex"},xe={class:""},ye={class:"sm:ms-6"},we={key:0,class:"sm:ms-6"},he={key:1,class:"sm:ms-6"},ke={class:"mb-2"},Ve=["value"],je={class:"mb-2"},Se=["value"],Ee={class:"mb-2"},qe={class:"mb-2"},Ue={class:"col-span-2 flex justify-between gap-2"},Ne={class:"flex pt-4 justify-end"},Ce={class:"flex pt-4 justify-end h-full"},$e={class:"flex justify-center my-12"},Ye={__name:"Registro",setup(Me){const U=P("$swal"),D=[{url:"",text:"Registro votantes"}],e=Q({nombre:"",identificacion:"",tipo_documento:"",nacimiento:"",comuna:u().props.user.jurado.comuna,id_jurado:u().props.user.jurado.id,id_evento:u().props.user.jurado.evento.id,genero:"",etnia:"",condicion:"",direccion:"",barrio:""}),_=p(!1),F=p([{label:"Validación previa"},{label:"Información"}]),I=p([{label:"paso 1"},{label:"paso 2"}]),c=p(0),f=p(""),x=p(""),d=p(!1),y=p(!1);p(!1),Z(y,l=>{l&&(e.genero="")});const z=l=>{c.value=l,d.value=!0},L=()=>{if(!e.nacimiento)return x.value="Debes ingresar la fecha de nacimiento.",!1;const l=new Date,o=e.nacimiento,[t,Y,A]=o.split("-").map(Number);let C=l.getFullYear()-t;const V=l.getMonth()-(Y-1);return console.log(l.getMonth()),console.log(V),console.log(l.getDate()),(V<0||V===0&&l.getDate()<A)&&C--,C<14?(x.value="No cumple con el requisito de edad mínima (14 años), por lo tanto, no puede ejercer el derecho al voto.",!1):(x.value="",!0)},B=async()=>{if(d.value=!1,_.value=!0,e.identificacion&&e.tipo_documento){f.value="",console.log(u().props);try{const l=await G(e.identificacion);if(console.log("Identificación data:",l),_.value=!1,l.existe){if(f.value="La identificación ya está registrada.",l.votante&&l.votante.votos.length>0)f.value+=" Y el votante ya ha emitido su voto en las elecciones.";else{window.location.href=route("votos.index",{id_votante:l.votante.id,evento:u().props.user.jurado.evento.id,tipo_evento:u().props.user.jurado.evento.tipos,tipo_user:l.votante.hash_votantes.length!=0?l.votante.hash_votantes[0].tipo:"",subtipo_user:l.votante.hash_votantes.length!=0?l.votante.hash_votantes[0].subtipo:""});return}d.value=!1}else f.value="",d.value=!0}catch{f.value="Error al validar la identificación. Intenta de nuevo.",d.value=!1}}d.value?c.value=1:(_.value=!1,(!e.identificacion||f.value!="")&&(e.errors.identificacion=f.value||"Este campo es requerido."),e.tipo_documento||(e.errors.tipo_documento="Este campo es requerido."))},G=async l=>{const o=await J.post("/validar-identificacion-presencial",{identificacion:l,registro_presencial:!0});return console.log(o.data),o.data},T=l=>{switch(d.value=!1,l){case 1:B();break;case 2:N();break}d.value&&(c.value=l)},N=()=>{if(d.value=!1,e.nombre&&e.nacimiento&&e.genero&&e.etnia&&e.condicion&&e.barrio&&e.direccion){if(d.value=!0,!L())return;O()}d.value||(e.nombre||(e.errors.nombre="Este campo es requerido."),e.nacimiento||(e.errors.nacimiento="Este campo es requerido."),e.genero||(e.errors.genero="Este campo es requerido."),e.etnia||(e.errors.etnia="Este campo es requerido."),e.condicion||(e.errors.condicion="Este campo es requerido."),e.barrio||(e.errors.barrio="Este campo es requerido."),e.direccion||(e.errors.direccion="Este campo es requerido."))},O=()=>{e.post(route("votantesPresencial.store"),{onSuccess:()=>{U({title:"Registro realizado",text:"Registro de votante realizado exitosamente.",icon:"success"}).then(l=>{console.log(l),window.location.href=route("votos.index",{id_votante:u().props.flash.success.id_votante,evento:u().props.user.jurado.evento.id,tipo_evento:u().props.user.jurado.evento.tipos,tipo_user:u().props.flash.success.hash_votante.tipo,subtipo_user:u().props.flash.success.hash_votante.subtipo})})},onError:l=>{U({title:"Error",text:"Ocurrió un error al registrar el votante.",icon:"error"}).then(o=>{c.value=0}),console.error(l)}})};return(l,o)=>(r(),n(h,null,[i(s(H),{title:"Registro votantes"}),i(K,{breadCrumbLinks:D},{header:w(()=>o[16]||(o[16]=[M(" Registro de votante ")])),default:w(()=>[a("div",ae,[o[24]||(o[24]=a("div",{class:"p-6 border-b border-gray-200"},[a("h1",null,"Registro votante")],-1)),a("div",ie,[i(s(R),{class:"hidden sm:block",model:F.value,activeStep:c.value,"onUpdate:activeStep":o[0]||(o[0]=t=>c.value=t)},null,8,["model","activeStep"]),i(s(R),{class:"sm:hidden block",model:I.value,activeStep:c.value,"onUpdate:activeStep":o[1]||(o[1]=t=>c.value=t)},null,8,["model","activeStep"])]),a("form",le,[c.value==0?(r(),n("div",ne,[a("div",re,[i(m,{for:"tipo_documento",value:"Tipo de Documento"}),b(a("select",{id:"tipo_documento","onUpdate:modelValue":o[2]||(o[2]=t=>s(e).tipo_documento=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[17]||(o[17]=a("option",{value:"",disabled:""},"Seleccione tipo de documento",-1)),(r(!0),n(h,null,S(s(W),t=>(r(),n("option",{key:t.id,value:t.nombre},k(t.nombre),9,de))),128))],512),[[E,s(e).tipo_documento]]),i(v,{class:"mt-2",message:s(e).errors.tipo_documento},null,8,["message"])]),a("div",ue,[i(m,{for:"identificacion",value:"Identificación"}),i(g,{id:"identificacion",type:"text",class:"mt-1 block w-full",modelValue:s(e).identificacion,"onUpdate:modelValue":o[3]||(o[3]=t=>s(e).identificacion=t),required:""},null,8,["modelValue"]),i(v,{class:"mt-2",message:s(e).errors.identificacion},null,8,["message"])]),a("div",ce,[a("button",{type:"button",class:$(["bg-secondary hover:bg-primary text-xs sm:text-sm text-white p-2 rounded-md shadow-xl",{"opacity-25":_.value}]),onClick:o[4]||(o[4]=t=>T(1)),disabled:_.value}," Siguiente ",10,me)])])):j("",!0),c.value==1?(r(),n("div",pe,[a("div",ve,[i(m,{for:"nombre",value:"Nombre Completo"}),i(g,{id:"nombre",type:"text",class:"mt-1 block w-full",modelValue:s(e).nombre,"onUpdate:modelValue":o[5]||(o[5]=t=>s(e).nombre=t),required:""},null,8,["modelValue"]),i(v,{class:"mt-2",message:s(e).errors.nombre},null,8,["message"])]),a("div",fe,[i(m,{for:"nacimiento",value:"Fecha de Nacimiento"}),i(g,{id:"nacimiento",type:"date",class:"mt-1 block w-full",modelValue:s(e).nacimiento,"onUpdate:modelValue":o[6]||(o[6]=t=>s(e).nacimiento=t),required:""},null,8,["modelValue"]),i(v,{class:"mt-2",message:s(e).errors.nacimiento},null,8,["message"]),x.value?(r(),n("p",be,k(x.value),1)):j("",!0)]),a("div",ge,[i(m,{for:"genero",value:"Género"}),a("div",_e,[a("div",xe,[b(a("input",{type:"radio",id:"masculino",value:"Masculino","onUpdate:modelValue":o[7]||(o[7]=t=>s(e).genero=t)},null,512),[[q,s(e).genero]]),o[18]||(o[18]=a("label",{class:"ps-2 text-sm sm:text-base",for:"masculino"},"Masculino",-1))]),a("div",ye,[b(a("input",{type:"radio",id:"two",value:"Femenino","onUpdate:modelValue":o[8]||(o[8]=t=>s(e).genero=t)},null,512),[[q,s(e).genero]]),o[19]||(o[19]=a("label",{class:"ps-2 text-sm sm:text-base",for:"two"},"Femenino",-1))]),y.value?(r(),n("div",we,[i(m,{class:"sm:text-sm text-xs",for:"genero",value:"¿Cual?"}),i(g,{id:"genero",type:"text",class:"mt-1 block w-full p-0 sm:p-1",modelValue:s(e).genero,"onUpdate:modelValue":o[9]||(o[9]=t=>s(e).genero=t),autocomplete:"genero"},null,8,["modelValue"]),i(v,{class:"mt-1",message:s(e).errors.genero},null,8,["message"])])):(r(),n("div",he,[b(a("input",{type:"radio",id:"tres",value:"true","onUpdate:modelValue":o[10]||(o[10]=t=>y.value=t)},null,512),[[q,y.value]]),o[20]||(o[20]=a("label",{class:"ps-2 text-sm sm:text-base",for:"tres"},"Otro",-1))]))])]),a("div",ke,[i(m,{for:"etnia",value:"Grupo poblacional"}),b(a("select",{id:"etnia","onUpdate:modelValue":o[11]||(o[11]=t=>s(e).etnia=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[21]||(o[21]=a("option",{value:"",disabled:""}," Seleccione grupo poblacional perteneciente ",-1)),(r(!0),n(h,null,S(s(X),t=>(r(),n("option",{key:t.id,value:t.nombre},k(t.nombre),9,Ve))),128))],512),[[E,s(e).etnia]]),i(v,{class:"mt-2",message:s(e).errors.etnia},null,8,["message"])]),a("div",je,[i(m,{for:"condicion",value:"Condición poblacional"}),b(a("select",{id:"condicion","onUpdate:modelValue":o[12]||(o[12]=t=>s(e).condicion=t),class:"mt-1 block w-full border-gray-300 rounded-lg"},[o[22]||(o[22]=a("option",{value:"",disabled:""}," Seleccione condición poblacional ",-1)),(r(!0),n(h,null,S(s(ee),t=>(r(),n("option",{key:t.id,value:t.nombre},k(t.nombre),9,Se))),128))],512),[[E,s(e).condicion]]),i(v,{class:"mt-2",message:s(e).errors.condicion},null,8,["message"])]),a("div",Ee,[i(m,{for:"barrio",value:"Barrio/Vereda"}),i(g,{id:"barrio",type:"text",class:"mt-1 block w-full",modelValue:s(e).barrio,"onUpdate:modelValue":o[13]||(o[13]=t=>s(e).barrio=t)},null,8,["modelValue"]),i(v,{class:"mt-2",message:s(e).errors.barrio},null,8,["message"])]),a("div",qe,[i(m,{for:"direccion",value:"Dirección"}),i(g,{id:"direccion",type:"text",class:"mt-1 block w-full",modelValue:s(e).direccion,"onUpdate:modelValue":o[14]||(o[14]=t=>s(e).direccion=t),required:""},null,8,["modelValue"]),i(v,{class:"mt-2",message:s(e).errors.direccion},null,8,["message"])]),a("div",Ue,[a("div",Ne,[a("button",{type:"button",onClick:o[15]||(o[15]=t=>z(0)),class:"bg-secondary hover:bg-primary text-xs sm:text-sm text-white px-4 rounded-md shadow-xl"}," Atrás ")]),a("div",Ce,[i(te,{type:"button",class:$(["h-full",{"opacity-25":s(e).processing}]),onClick:N,disabled:s(e).processing},{default:w(()=>o[23]||(o[23]=[M(" Siguiente ")])),_:1},8,["class","disabled"])])])])):j("",!0)])])]),_:1}),i(se,{show:l.loadingModal,closeable:!1},{default:w(()=>[o[25]||(o[25]=a("h2",{class:"py-4 text-2xl font-semibold text-gray-800 flex tex-center justify-center bg-azul text-white"}," Cargando datos... ",-1)),a("div",$e,[i(s(oe),{"aria-label":"Loading"})])]),_:1},8,["show"])],64))}};export{Ye as default};
