import{r as s,s as w,w as y,c as d,o as u,e as o,f as k,v as F,F as D,k as _,t as g,z as b}from"./app-CdV8BIqP.js";import{n as v,d as C,T as E}from"./FaceMatcher-DQZ88WER.js";const L=["value"],x={__name:"ConfirmPassword",setup(N){const n=s(null),t=s(""),c=s("register"),m=s(!1),l=s([]),i=s("");w(async()=>{try{await v.tinyFaceDetector.loadFromUri("/models/tiny_face_detector"),await v.faceRecognitionNet.loadFromUri("/models/face_recognition"),await v.faceLandmark68Net.loadFromUri("/models/face_landmark_68");const a=await navigator.mediaDevices.enumerateDevices();l.value=a.filter(r=>r.kind==="videoinput");const e=l.value.find(r=>r.label.toLowerCase().includes("user"))||l.value[0];i.value=(e==null?void 0:e.deviceId)||"",await f(i.value)}catch(a){console.error("Error al iniciar:",a),t.value="No se pudo acceder a la cámara."}});const f=async a=>{try{const e=await navigator.mediaDevices.getUserMedia({video:{deviceId:{exact:a}}});n.value.srcObject=e,m.value=!0}catch(e){console.error("Error al iniciar cámara:",e),t.value="Error al iniciar la cámara."}};y(i,async a=>{a&&await f(a)});const p=async()=>{if(!m.value){t.value="La cámara no está lista.";return}try{const a=await C(n.value,new E).withFaceLandmarks().withFaceDescriptor();if(console.log("entro -- validador"),!a){t.value="No se detectó un rostro.";return}const e=a.descriptor;console.log("emb",e);const r=await b.post(`/face-${c.value}`,{embedding:e,user_id:1});t.value=r.data.message}catch(a){console.error(a),t.value="Error al procesar el rostro."}};return(a,e)=>(u(),d("div",null,[e[3]||(e[3]=o("label",{for:"camera"},"Seleccionar cámara:",-1)),k(o("select",{id:"camera","onUpdate:modelValue":e[0]||(e[0]=r=>i.value=r)},[(u(!0),d(D,null,_(l.value,r=>(u(),d("option",{key:r.deviceId,value:r.deviceId},g(r.label||"Cámara desconocida"),9,L))),128))],512),[[F,i.value]]),o("video",{ref_key:"video",ref:n,autoplay:"",muted:"",width:"320",height:"240"},null,512),o("div",null,[o("button",{onClick:e[1]||(e[1]=r=>{c.value="register",p()})},"Registrar rostro"),o("button",{onClick:e[2]||(e[2]=r=>{c.value="validate",p()})},"Validar rostro")]),o("p",null,g(t.value),1)]))}};export{x as default};
