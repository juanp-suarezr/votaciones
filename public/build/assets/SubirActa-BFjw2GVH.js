import{x as M,T as P,r as C,q as z,w as H,c as f,o as v,b as t,u as s,Z as A,d as k,e as l,t as j,B as D,p as F,l as W,n as N,j as I,F as T,k as Z}from"./app--nvlW22i.js";import{_ as G}from"./AuthenticatedLayout-DeJagJ1x.js";import{_ as r}from"./InputError--Vz-3DXG.js";import{_ as i}from"./InputLabel-CcP6zGgI.js";import{_ as J}from"./PrimaryButton-CWH7gqks.js";import{_ as n}from"./TextInput-BJNZbZlU.js";import{s as K}from"./index-YZ2yHvpU.js";import{r as Q}from"./PhotoIcon-D0jfFdko.js";import"./SecondaryButtonReturn-CXy2FjJm.js";import"./XCircleIcon-Cy2qCbJi.js";import"./index-NORLqXfg.js";import"./index-BhcIhu1s.js";const X={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},Y={class:"p-6 border-b border-gray-200"},ee={class:"sm:text-xl text-lg font-bold"},oe={class:"mt-2"},se={class:"bg-white p-4 rounded-lg shadow h-auto"},te={class:"flex justify-center items-center mt-4"},ae={class:"border-2 border-gray-300 rounded-md h-full"},le={class:"flex justify-center"},re=["src","alt"],ie={key:0,class:"flex justify-center mt-2"},ne={class:"bg-white p-4 rounded-lg shadow h-full"},de={class:"mt-4 flex flex-wrap gap-4"},ce={class:"mb-2 w-full md:pe-8"},ue={class:"mb-2 sm:w-[calc(50%-.8rem)]"},me={class:"mb-2 sm:w-[calc(50%-0.8rem)]"},ve={class:"mb-2"},_e={class:"mb-2"},fe={class:"mb-2"},ge={class:"mb-2"},be={class:"mb-2 w-1/4"},pe={class:"mb-2 w-full"},we={key:0},Ve={class:"mb-2 w-1/4"},he={class:"mb-2 w-1/4"},ye={class:"mb-2 w-1/4"},xe={class:"mb-2 w-1/4"},ke={class:"flex justify-center items-center w-full col-span-2 mt-4"},Le={__name:"SubirActa",props:{proyectos:Object,evento:Object,comuna:Number,puesto_votacion:Number,id_jurado:Number,eventos_hijos_vigentes:Object,actas_enviadas:Object,faltan_actas:Number},setup(p){const w=M("$swal"),_=p;console.log(_);const e=P({id_evento:_.eventos_hijos_vigentes[0].id,id_jurado:_.id_jurado,comuna:_.comuna,puesto_votacion:_.puesto_votacion,nombre_testigo:"",Identification_testigo:"",contacto_testigo:"",fecha_inicio:"",fecha_fin:"",hora_inicio:"",hora_cierre:"",votos_nulos:0,votos_blancos:0,votos_no_marcados:0,total_ciudadanos:0,total_votantes:0,observaciones:"",evidencia:null,votos_proyectos:{}}),m=C(null),V=C(!1),U=z(()=>{const o=e.observaciones.trim().length;return o>=250?V.value=!0:V.value=!1,o});H(U,()=>{e.observaciones=e.observaciones.trim()});const R=d=>(console.log(d),_.proyectos[d]||[]),S=d=>{const o=d.target.files[0];if(!o){m.value=null;return}const a=new FileReader;a.onload=g=>{const b=new Image;b.onload=()=>{const h=document.createElement("canvas"),$=h.getContext("2d"),y=1024,x=1024;let c=b.width,u=b.height;(c>y||u>x)&&(c>u?(u=Math.round(u*y/c),c=y):(c=Math.round(c*x/u),u=x)),h.width=c,h.height=u,$.drawImage(b,0,0,c,u),h.toBlob(q=>{if(q.size>2e6){Swal.fire({icon:"error",title:"Error",text:"Incluso comprimida, la imagen supera los 2MB."});return}const E=new File([q],o.name,{type:"image/jpeg",lastModified:Date.now()});m.value=URL.createObjectURL(E),e.evidencia=E},"image/jpeg",.8)},b.src=g.target.result},a.readAsDataURL(o)},B=()=>{e.evidencia=null,m.value=null},L=()=>{const d=parseInt(e.votos_blancos)+parseInt(e.votos_nulos)+parseInt(e.votos_no_marcados),o=Object.values(e.votos_proyectos).reduce((a,g)=>parseInt(a)+parseInt(g||0),0);if(console.log("Total votos:",d),console.log("Total proyectos:",o),console.log("Total ciudadanos:",e.total_ciudadanos),console.log("Total votantes:",e.total_votantes),parseInt(e.total_ciudadanos)!=parseInt(e.total_votantes)){w.fire({icon:"error",title:"Error",text:"El total de ciudadanos registrados debe ser igual al total de ciudadanos votantes"});return}else if(parseInt(e.total_votantes)!=d+parseInt(o)){w.fire({icon:"error",title:"Error",text:"El total de votantes debe ser igual a la suma de votos nulos, blancos, no marcados y votos por proyecto."});return}console.log(e),e.post(route("actaPresencial.store"),{onSuccess:()=>{w.fire({icon:"success",title:"Éxito",text:"Acta de escrutinio cargada correctamente."}),e.reset(),m.value=null},onError:a=>{console.error(a),w.fire({icon:"error",title:"Error",text:"Hubo un error al enviar el formulario. Por favor, verifica los datos e intenta nuevamente."})}})},O=[{url:"",text:"Carga acta de escrutinio"}];return(d,o)=>(v(),f(T,null,[t(s(A),{title:"Carga de acta"}),t(G,{breadCrumbLinks:O},{header:k(()=>o[15]||(o[15]=[I(" Carga acta de escrutinio y registros ")])),default:k(()=>[l("div",X,[l("div",Y,[l("h1",ee,"Proceso de votación presencial física - "+j(p.eventos_hijos_vigentes[0].nombre),1),l("p",oe,j(p.faltan_actas)+" actas por enviar ",1)]),l("form",{onSubmit:D(L,["prevent"]),class:"md:grid md:grid-cols-2 gap-4 p-6"},[l("div",se,[o[16]||(o[16]=l("h2",{class:"text-lg font-semibold mb-4"},"Subir acta de escrutinio",-1)),o[17]||(o[17]=l("p",null,"Sube el acta de escrutinio en formato imagen.",-1)),l("div",te,[l("div",ae,[t(n,{id:"evidencia",type:"file",class:"!border-0",accept:"image/*",required:"",onInput:o[0]||(o[0]=a=>S(a)),maxFileSize:2e6}),t(r,{class:"mt-2",message:s(e).errors.evidencia},null,8,["message"]),l("div",le,[m.value?(v(),f("img",{key:0,src:m.value,alt:s(e).evidencia,class:"w-4/6 h-full object-contain"},null,8,re)):(v(),W(s(Q),{key:1,class:"w-2/6 text-gray-300 flex justify-center items-center"}))]),m.value?(v(),f("div",ie,[l("button",{onClick:o[1]||(o[1]=a=>B()),type:"button",class:"bg-red-500 text-white px-4 py-2 rounded"}," Eliminar Imagen ")])):F("",!0)])])]),l("div",ne,[o[19]||(o[19]=l("h2",{class:"text-lg font-semibold mb-4"},"Registro de información",-1)),o[20]||(o[20]=l("p",null,"Registra la información y numero de votos por proyecto",-1)),l("div",de,[l("div",ce,[t(i,{for:"nombre_testigo",value:"Nombre del testigo"}),t(n,{id:"nombre_testigo",modelValue:s(e).nombre_testigo,"onUpdate:modelValue":o[2]||(o[2]=a=>s(e).nombre_testigo=a),class:"mt-1 block w-full",type:"text",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.nombre_testigo,class:"mt-2"},null,8,["message"])]),l("div",ue,[t(i,{for:"Identification_testigo",value:"Identificación del testigo"}),t(n,{id:"Identification_testigo",modelValue:s(e).Identification_testigo,"onUpdate:modelValue":o[3]||(o[3]=a=>s(e).Identification_testigo=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.Identification_testigo,class:"mt-2"},null,8,["message"])]),l("div",me,[t(i,{for:"contacto_testigo",value:"Contacto del testigo"}),t(n,{id:"contacto_testigo",modelValue:s(e).contacto_testigo,"onUpdate:modelValue":o[4]||(o[4]=a=>s(e).contacto_testigo=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.contacto_testigo,class:"mt-2"},null,8,["message"])]),l("div",ve,[t(i,{for:"fecha_inicio",value:"Fecha de inicio"}),t(n,{id:"fecha_inicio",modelValue:s(e).fecha_inicio,"onUpdate:modelValue":o[5]||(o[5]=a=>s(e).fecha_inicio=a),class:"mt-1 block w-full",type:"date",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.fecha_inicio,class:"mt-2"},null,8,["message"])]),l("div",_e,[t(i,{for:"fecha_fin",value:"Fecha de fin"}),t(n,{id:"fecha_fin",modelValue:s(e).fecha_fin,"onUpdate:modelValue":o[6]||(o[6]=a=>s(e).fecha_fin=a),class:"mt-1 block w-full",type:"date",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.fecha_fin,class:"mt-2"},null,8,["message"])]),l("div",fe,[t(i,{for:"hora_inicio",value:"Hora de inicio"}),t(n,{id:"hora_inicio",modelValue:s(e).hora_inicio,"onUpdate:modelValue":o[7]||(o[7]=a=>s(e).hora_inicio=a),class:"mt-1 block w-full",type:"time",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.hora_inicio,class:"mt-2"},null,8,["message"])]),l("div",ge,[t(i,{for:"hora_cierre",value:"Hora de cierre"}),t(n,{id:"hora_cierre",modelValue:s(e).hora_cierre,"onUpdate:modelValue":o[8]||(o[8]=a=>s(e).hora_cierre=a),class:"mt-1 block w-full",type:"time",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.hora_cierre,class:"mt-2"},null,8,["message"])]),l("div",be,[t(i,{for:"total_ciudadanos",value:"Total ciudadanos registrados"}),t(n,{id:"total_ciudadanos",modelValue:s(e).total_ciudadanos,"onUpdate:modelValue":o[9]||(o[9]=a=>s(e).total_ciudadanos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.total_ciudadanos,class:"mt-2"},null,8,["message"])]),l("div",pe,[t(i,{for:"observaciones",value:"Observaciones (max 250 caracteres)"}),t(s(K),{modelValue:s(e).observaciones,"onUpdate:modelValue":o[10]||(o[10]=a=>s(e).observaciones=a),variant:"filled",autoResize:"",rows:"5",class:"mt-1 block w-full",required:"",autocomplete:"observaciones"},null,8,["modelValue"]),l("p",{class:N(["text-gray-500 text-sm mt-2",{"text-red-500":V.value}])},[I(j(U.value)+" caracteres ",1),V.value?(v(),f("span",we,"Limite de caracteres superado")):F("",!0)],2),t(r,{message:s(e).errors.observaciones,class:"mt-2"},null,8,["message"])]),o[18]||(o[18]=l("div",{class:"w-full"},[l("h2",null,"Registro de votos")],-1)),l("div",Ve,[t(i,{for:"votos_nulos",value:"Votos nulos"}),t(n,{id:"votos_nulos",modelValue:s(e).votos_nulos,"onUpdate:modelValue":o[11]||(o[11]=a=>s(e).votos_nulos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_nulos,class:"mt-2"},null,8,["message"])]),l("div",he,[t(i,{for:"votos_blancos",value:"Votos blancos"}),t(n,{id:"votos_blancos",modelValue:s(e).votos_blancos,"onUpdate:modelValue":o[12]||(o[12]=a=>s(e).votos_blancos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_blancos,class:"mt-2"},null,8,["message"])]),l("div",ye,[t(i,{for:"votos_no_marcados",value:"Votos no marcados"}),t(n,{id:"votos_no_marcados",modelValue:s(e).votos_no_marcados,"onUpdate:modelValue":o[13]||(o[13]=a=>s(e).votos_no_marcados=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_no_marcados,class:"mt-2"},null,8,["message"])]),(v(!0),f(T,null,Z(R(p.eventos_hijos_vigentes[0].id),a=>(v(),f("div",{key:a.id,class:"mb-2 w-full"},[t(i,{for:"votos_proyecto_"+a.id,value:"Votos proyecto --"+a.numero_tarjeton+" "+a.nombre},null,8,["for","value"]),t(n,{id:"votos_proyecto_"+a.id,modelValue:s(e).votos_proyectos[a.id],"onUpdate:modelValue":g=>s(e).votos_proyectos[a.id]=g,class:"mt-1 block w-full",type:"number",required:""},null,8,["id","modelValue","onUpdate:modelValue"]),t(r,{message:s(e).errors["votos_proyectos."+a.id],class:"mt-2"},null,8,["message"])]))),128)),l("div",xe,[t(i,{for:"total_votantes",value:"Total votantes"}),t(n,{id:"total_votantes",modelValue:s(e).total_votantes,"onUpdate:modelValue":o[14]||(o[14]=a=>s(e).total_votantes=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.total_votantes,class:"mt-2"},null,8,["message"])])])]),l("div",ke,[t(J,{class:N(["w-auto",{"opacity-25":s(e).processing}]),disabled:s(e).processing},{default:k(()=>o[21]||(o[21]=[I(" Enviar ")])),_:1},8,["class","disabled"])])],32)])]),_:1})],64))}};export{Le as default};
