import{k as B,T as M,r as q,c as z,w as A,a as f,b as m,d as t,u as s,Z as O,e as x,f as l,s as D,l as C,i as H,n as E,j as k,t as P,F,h as W}from"./app-BPgjCkt6.js";import{_ as Z}from"./AuthenticatedLayout-tePjzt6V.js";import{_ as r}from"./InputError-C127L_gj.js";import{_ as i}from"./InputLabel-DYGAFQZj.js";import{_ as G}from"./PrimaryButton-CAN_4sjW.js";import{_ as n}from"./TextInput-BOCYqhWE.js";import{s as J}from"./index-BX2O54Np.js";import{r as K}from"./PhotoIcon-CiaXm8KG.js";import"./SecondaryButtonReturn-C44SUDFF.js";import"./XCircleIcon-gZlCWiP-.js";import"./index-BhzlbghG.js";import"./index-OWzKREdx.js";const Q={class:"bg-white overflow-hidden shadow-sm sm:rounded-lg"},X={class:"bg-white p-4 rounded-lg shadow h-auto"},Y={class:"flex justify-center items-center mt-4"},ee={class:"border-2 border-gray-300 rounded-md h-full"},oe={class:"flex justify-center"},se=["src","alt"],te={key:0,class:"flex justify-center mt-2"},ae={class:"bg-white p-4 rounded-lg shadow h-full"},le={class:"mt-4 flex flex-wrap gap-4"},re={class:"mb-2 w-full md:pe-8"},ie={class:"mb-2 sm:w-[calc(50%-.8rem)]"},ne={class:"mb-2 sm:w-[calc(50%-0.8rem)]"},de={class:"mb-2"},ce={class:"mb-2"},ue={class:"mb-2"},me={class:"mb-2"},ve={class:"mb-2 w-1/4"},_e={class:"mb-2 w-full"},fe={key:0},ge={class:"mb-2 w-1/4"},pe={class:"mb-2 w-1/4"},be={class:"mb-2 w-1/4"},we={class:"mb-2 w-1/4"},Ve={class:"flex justify-center items-center w-full col-span-2 mt-4"},Ne={__name:"SubirActa",props:{proyectos:Array,evento:Object,comuna:Number,puesto_votacion:Number,id_jurado:Number},setup(T){const V=B("$swal"),v=T;console.log(v);const e=M({id_evento:v.evento.id,id_jurado:v.id_jurado,comuna:v.comuna,puesto_votacion:v.puesto_votacion,nombre_testigo:"",Identification_testigo:"",contacto_testigo:"",fecha_inicio:"",fecha_fin:"",hora_inicio:"",hora_cierre:"",votos_nulos:0,votos_blancos:0,votos_no_marcados:0,total_ciudadanos:0,total_votantes:0,observaciones:"",evidencia:null,votos_proyectos:{}}),u=q(null),b=q(!1),I=z(()=>{const o=e.observaciones.trim().length;return o>=250?b.value=!0:b.value=!1,o});A(I,()=>{e.observaciones=e.observaciones.trim()});const N=_=>{const o=_.target.files[0];if(!o){u.value=null;return}const a=new FileReader;a.onload=g=>{const p=new Image;p.onload=()=>{const w=document.createElement("canvas"),$=w.getContext("2d"),y=1024,h=1024;let d=p.width,c=p.height;(d>y||c>h)&&(d>c?(c=Math.round(c*y/d),d=y):(d=Math.round(d*h/c),c=h)),w.width=d,w.height=c,$.drawImage(p,0,0,d,c),w.toBlob(U=>{if(U.size>2e6){Swal.fire({icon:"error",title:"Error",text:"Incluso comprimida, la imagen supera los 2MB."});return}const j=new File([U],o.name,{type:"image/jpeg",lastModified:Date.now()});u.value=URL.createObjectURL(j),e.evidencia=j},"image/jpeg",.8)},p.src=g.target.result},a.readAsDataURL(o)},R=()=>{e.evidencia=null,u.value=null},S=()=>{const _=parseInt(e.votos_blancos)+parseInt(e.votos_nulos)+parseInt(e.votos_no_marcados),o=Object.values(e.votos_proyectos).reduce((a,g)=>parseInt(a)+parseInt(g||0),0);if(console.log("Total votos:",_),console.log("Total proyectos:",o),console.log("Total ciudadanos:",e.total_ciudadanos),console.log("Total votantes:",e.total_votantes),parseInt(e.total_ciudadanos)!=parseInt(e.total_votantes)){V.fire({icon:"error",title:"Error",text:"El total de ciudadanos registrados debe ser igual al total de ciudadanos votantes"});return}else if(parseInt(e.total_votantes)!=_+parseInt(o)){V.fire({icon:"error",title:"Error",text:"El total de votantes debe ser igual a la suma de votos nulos, blancos, no marcados y votos por proyecto."});return}console.log(e),e.post(route("actaPresencial.store"),{onSuccess:()=>{V.fire({icon:"success",title:"Éxito",text:"Acta de escrutinio cargada correctamente."}),e.reset(),u.value=null,window.location.href=route("dashboard")},onError:a=>{console.error(a)}})},L=[{url:"",text:"Carga acta de escrutinio"}];return(_,o)=>(m(),f(F,null,[t(s(O),{title:"Carga de acta"}),t(Z,{breadCrumbLinks:L},{header:x(()=>o[15]||(o[15]=[k(" Carga acta de escrutinio y registros ")])),default:x(()=>[l("div",Q,[o[22]||(o[22]=l("div",{class:"p-6 border-b border-gray-200"},[l("h1",null,"Proceso de votación presencial física")],-1)),l("form",{onSubmit:D(S,["prevent"]),class:"md:grid md:grid-cols-2 gap-4 p-6"},[l("div",X,[o[16]||(o[16]=l("h2",{class:"text-lg font-semibold mb-4"},"Subir acta de escrutinio",-1)),o[17]||(o[17]=l("p",null,"Sube el acta de escrutinio en formato imagen.",-1)),l("div",Y,[l("div",ee,[t(n,{id:"evidencia",type:"file",class:"!border-0",accept:"image/*",required:"",onInput:o[0]||(o[0]=a=>N(a)),maxFileSize:2e6}),t(r,{class:"mt-2",message:s(e).errors.evidencia},null,8,["message"]),l("div",oe,[u.value?(m(),f("img",{key:0,src:u.value,alt:s(e).evidencia,class:"w-4/6 h-full object-contain"},null,8,se)):(m(),H(s(K),{key:1,class:"w-2/6 text-gray-300 flex justify-center items-center"}))]),u.value?(m(),f("div",te,[l("button",{onClick:o[1]||(o[1]=a=>R()),type:"button",class:"bg-red-500 text-white px-4 py-2 rounded"}," Eliminar Imagen ")])):C("",!0)])])]),l("div",ae,[o[19]||(o[19]=l("h2",{class:"text-lg font-semibold mb-4"},"Registro de información",-1)),o[20]||(o[20]=l("p",null,"Registra la información y numero de votos por proyecto",-1)),l("div",le,[l("div",re,[t(i,{for:"nombre_testigo",value:"Nombre del testigo"}),t(n,{id:"nombre_testigo",modelValue:s(e).nombre_testigo,"onUpdate:modelValue":o[2]||(o[2]=a=>s(e).nombre_testigo=a),class:"mt-1 block w-full",type:"text",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.nombre_testigo,class:"mt-2"},null,8,["message"])]),l("div",ie,[t(i,{for:"Identification_testigo",value:"Identificación del testigo"}),t(n,{id:"Identification_testigo",modelValue:s(e).Identification_testigo,"onUpdate:modelValue":o[3]||(o[3]=a=>s(e).Identification_testigo=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.Identification_testigo,class:"mt-2"},null,8,["message"])]),l("div",ne,[t(i,{for:"contacto_testigo",value:"Contacto del testigo"}),t(n,{id:"contacto_testigo",modelValue:s(e).contacto_testigo,"onUpdate:modelValue":o[4]||(o[4]=a=>s(e).contacto_testigo=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.contacto_testigo,class:"mt-2"},null,8,["message"])]),l("div",de,[t(i,{for:"fecha_inicio",value:"Fecha de inicio"}),t(n,{id:"fecha_inicio",modelValue:s(e).fecha_inicio,"onUpdate:modelValue":o[5]||(o[5]=a=>s(e).fecha_inicio=a),class:"mt-1 block w-full",type:"date",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.fecha_inicio,class:"mt-2"},null,8,["message"])]),l("div",ce,[t(i,{for:"fecha_fin",value:"Fecha de fin"}),t(n,{id:"fecha_fin",modelValue:s(e).fecha_fin,"onUpdate:modelValue":o[6]||(o[6]=a=>s(e).fecha_fin=a),class:"mt-1 block w-full",type:"date",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.fecha_fin,class:"mt-2"},null,8,["message"])]),l("div",ue,[t(i,{for:"hora_inicio",value:"Hora de inicio"}),t(n,{id:"hora_inicio",modelValue:s(e).hora_inicio,"onUpdate:modelValue":o[7]||(o[7]=a=>s(e).hora_inicio=a),class:"mt-1 block w-full",type:"time",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.hora_inicio,class:"mt-2"},null,8,["message"])]),l("div",me,[t(i,{for:"hora_cierre",value:"Hora de cierre"}),t(n,{id:"hora_cierre",modelValue:s(e).hora_cierre,"onUpdate:modelValue":o[8]||(o[8]=a=>s(e).hora_cierre=a),class:"mt-1 block w-full",type:"time",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.hora_cierre,class:"mt-2"},null,8,["message"])]),l("div",ve,[t(i,{for:"total_ciudadanos",value:"Total ciudadanos registrados"}),t(n,{id:"total_ciudadanos",modelValue:s(e).total_ciudadanos,"onUpdate:modelValue":o[9]||(o[9]=a=>s(e).total_ciudadanos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.total_ciudadanos,class:"mt-2"},null,8,["message"])]),l("div",_e,[t(i,{for:"observaciones",value:"Observaciones (max 250 caracteres)"}),t(s(J),{modelValue:s(e).observaciones,"onUpdate:modelValue":o[10]||(o[10]=a=>s(e).observaciones=a),variant:"filled",autoResize:"",rows:"5",class:"mt-1 block w-full",required:"",autocomplete:"observaciones"},null,8,["modelValue"]),l("p",{class:E(["text-gray-500 text-sm mt-2",{"text-red-500":b.value}])},[k(P(I.value)+" caracteres ",1),b.value?(m(),f("span",fe,"Limite de caracteres superado")):C("",!0)],2),t(r,{message:s(e).errors.observaciones,class:"mt-2"},null,8,["message"])]),o[18]||(o[18]=l("div",{class:"w-full"},[l("h2",null,"Registro de votos")],-1)),l("div",ge,[t(i,{for:"votos_nulos",value:"Votos nulos"}),t(n,{id:"votos_nulos",modelValue:s(e).votos_nulos,"onUpdate:modelValue":o[11]||(o[11]=a=>s(e).votos_nulos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_nulos,class:"mt-2"},null,8,["message"])]),l("div",pe,[t(i,{for:"votos_blancos",value:"Votos blancos"}),t(n,{id:"votos_blancos",modelValue:s(e).votos_blancos,"onUpdate:modelValue":o[12]||(o[12]=a=>s(e).votos_blancos=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_blancos,class:"mt-2"},null,8,["message"])]),l("div",be,[t(i,{for:"votos_no_marcados",value:"Votos no marcados"}),t(n,{id:"votos_no_marcados",modelValue:s(e).votos_no_marcados,"onUpdate:modelValue":o[13]||(o[13]=a=>s(e).votos_no_marcados=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.votos_no_marcados,class:"mt-2"},null,8,["message"])]),(m(!0),f(F,null,W(v.proyectos,a=>(m(),f("div",{key:a.id,class:"mb-2 w-full"},[t(i,{for:"votos_proyecto_"+a.id,value:"Votos proyecto --"+a.proyecto.numero_tarjeton+" "+a.proyecto.detalle},null,8,["for","value"]),t(n,{id:"votos_proyecto_"+a.id,modelValue:s(e).votos_proyectos[a.proyecto.id],"onUpdate:modelValue":g=>s(e).votos_proyectos[a.proyecto.id]=g,class:"mt-1 block w-full",type:"number",required:""},null,8,["id","modelValue","onUpdate:modelValue"]),t(r,{message:s(e).errors["votos_proyectos."+a.proyecto.id],class:"mt-2"},null,8,["message"])]))),128)),l("div",we,[t(i,{for:"total_votantes",value:"Total votantes"}),t(n,{id:"total_votantes",modelValue:s(e).total_votantes,"onUpdate:modelValue":o[14]||(o[14]=a=>s(e).total_votantes=a),class:"mt-1 block w-full",type:"number",required:""},null,8,["modelValue"]),t(r,{message:s(e).errors.total_votantes,class:"mt-2"},null,8,["message"])])])]),l("div",Ve,[t(G,{class:E(["w-auto",{"opacity-25":s(e).processing}]),disabled:s(e).processing},{default:x(()=>o[21]||(o[21]=[k(" Enviar ")])),_:1},8,["class","disabled"])])],32)])]),_:1})],64))}};export{Ne as default};
